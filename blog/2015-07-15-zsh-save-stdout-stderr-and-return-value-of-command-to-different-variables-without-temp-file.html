<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<meta content="Zhiming Wang" name="author"/>
<meta content="2015-07-15T09:21:47-07:00" name="date"/>
<title>Zsh: save stdout, stderr, and return value of command to different variables (without temp file)</title>
<link href="/img/apple-touch-icon-152.png" rel="apple-touch-icon-precomposed"/>
<meta content="#FFFFFF" name="msapplication-TileColor"/>
<meta content="/img/favicon-144.png" name="msapplication-TileImage"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="/css/fonts.css" media="all" rel="stylesheet" type="text/css"/>
<link href="/css/normalize.css" media="all" rel="stylesheet" type="text/css"/>
<link href="/css/theme.css" media="all" rel="stylesheet" type="text/css"/>
<link href="/css/theme-wide.css" media="only screen and (min-width: 1441px)" rel="stylesheet" type="text/css"/>
<link href="/css/theme-narrow.css" media="only screen and (max-width: 1023px)" rel="stylesheet" type="text/css"/>
<link href="/css/theme-ultranarrow.css" media="only screen and (max-width: 500px)" rel="stylesheet" type="text/css"/>
<link href="/css/highlight.css" media="all" rel="stylesheet" type="text/css"/>
<link href="/css/print.css" media="print" rel="stylesheet" type="text/css"/>
</head>
<body>
<nav class="nav">
<a class="nav-icon" href="/" title="Home"><!--blog icon--></a>
<a class="nav-title" href="/"><!--blog title--></a>
<a class="nav-author" href="https://github.com/zmwangx" target="_blank"><!--blog author--></a>
</nav>
<article class="content">
<header class="article-header">
<h1 class="article-title">Zsh: save stdout, stderr, and return value of command to different variables (without temp file)</h1>
<div class="article-metadata">
<time class="article-timestamp" datetime="2015-07-15T09:21:47-07:00">July 15, 2015</time>
</div>
</header>
<p>This is something worth sharing. The idea was based on <a href="http://stackoverflow.com/a/18086548/1944784">this SO answer</a>, and I cooked up this particular implementation to remove potential race conditions, with input from Mathias Fredriksson<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a>. See <a href="https://github.com/mafredri/zsh-async/issues/1">mafredri/zsh-async#1</a>, and in particular <a href="https://github.com/mafredri/zsh-async/issues/1#issuecomment-121468958">this comment</a> for explanation.</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="co"># The following construct evaluates "$@" and saves output on stdout in the</span>
<span class="co"># parameter stdout, output on stderr in the parameter stderr, and return value</span>
<span class="co"># in the parameter return.</span>
<span class="co">#</span>
<span class="co"># The idea was based on http://stackoverflow.com/a/18086548/1944784, but this</span>
<span class="co"># implementation is completely race-condition-free. The implementation was</span>
<span class="co"># refined during my exchange with Mathias Fredriksson @mafredri, in</span>
<span class="co"># https://github.com/mafredri/zsh-async/issues/1. See mainly</span>
<span class="co"># https://github.com/mafredri/zsh-async/issues/1#issuecomment-121468958, where</span>
<span class="co"># the advantage of this implementation is explained.</span>

<span class="kw">unset</span> stdout stderr ret
<span class="kw">eval</span> <span class="st">"</span>
<span class="ot">$(</span>
    <span class="kw">{</span>
        <span class="ot">stdout=$(</span><span class="kw">eval</span> <span class="st">"</span><span class="ot">$@</span><span class="st">"</span><span class="ot">)</span>
        <span class="ot">ret=$?</span>
        <span class="kw">typeset</span> -p <span class="ot">stdout</span> <span class="ot">ret</span>
    <span class="kw">}</span> <span class="kw">2&gt;</span> <span class="kw">&gt;(</span><span class="ot">stderr=$(</span><span class="kw">cat</span><span class="ot">)</span>; <span class="kw">typeset</span> -p <span class="ot">stderr</span><span class="kw">)</span>
<span class="ot">)</span><span class="st">"</span></code></pre></div>
<p>Also available as <a href="https://gist.github.com/zmwangx/efababea6258cedea07a">a gist</a>.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>Mathias (<a href="https://github.com/mafredri">@mafredri</a>) is the author of the lovely <a href="https://github.com/mafredri/zsh-async">zsh-async</a> library, and a maintainer of <a href="https://github.com/sindresorhus/pure">sindresorhus/pure</a>. He forever revolutionalized <a href="https://github.com/zmwangx/prezto/blob/master/modules/prompt/functions/prompt_zmwangx_setup">my prompt</a>.<a class="footnotes-backlink" href="#fnref1">↩︎</a></p></li>
</ol>
</div>
</article>
<hr class="content-separator"/>
<footer class="footer">
<span class="rfooter">
<a class="rss-icon" href="/rss.xml" target="_blank" title="RSS feed"><!--RSS feed icon--></a><a class="atom-icon" href="/atom.xml" target="_blank" title="Atom feed"><!--Atom feed icon--></a><a class="cc-icon" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" title="Released under the Creative Commons Attribution 4.0 International license."><!--CC icon--></a>
<a href="https://github.com/zmwangx" target="_blank">Zhiming Wang</a>
</span>
</footer>
</body>
</html>
