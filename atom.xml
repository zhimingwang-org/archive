<feed xmlns="http://www.w3.org/2005/Atom"><title>dl? cmplnts?</title><link href="http://zmwangx.github.io/atom.xml" rel="self" /><link href="http://zmwangx.github.io" /><updated>2015-05-19T18:34:52-07:00</updated><id>http://zmwangx.github.io</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><icon>http://zmwangx.github.io/img/icon-400.png</icon><generator uri="https://github.com/zmwangx/zmwangx.github.io">pyblog</generator><entry><title type="html">Bash: the special slash character in filename expansion</title><link href="http://zmwangx.github.io/blog/2015-05-19-bash-the-special-slash-character-in-filename-expansion.html" /><updated>2015-05-19T18:33:51-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-19-bash-the-special-slash-character-in-filename-expansion.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>It is well-known and common sense that the slash character (<code>/</code>) serves a special role in Bash filename expansion. For instance, the asterisk <code>*</code> certainly won't match <code>/</code> or <code>.</code> when used in filename expansion; otherwise, a standalone <code>*</code> would match everything in the filesystem.</p>
<p>However, it is less clear how a literal slash character<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> is treated in extended glob patterns. Naively one would expect it to just match a literal slash, but the real situtation is more complicated than that. Consider the following examples:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bash-4.3</span>$ shopt -s extglob nullglob
<span class="kw">bash-4.3</span>$ echo /usr/@(bin<span class="kw">|lib</span>)
<span class="kw">/usr/bin</span> /usr/lib
<span class="kw">bash-4.3</span>$ echo /usr@(/bin<span class="kw">|/lib</span>)

<span class="kw">bash-4.3</span>$ [[ /usr/bin == /usr@(/bin<span class="kw">|/lib</span>) ]] <span class="kw">&amp;&amp;</span> <span class="kw">echo</span> matching
<span class="kw">matching</span><span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span></code></pre></div>
<p>As seen from this example, patterns with slash simply doesn't work (in filename expansion) when place in an extended glob pattern list, and there's no error whatsoever. I looked up the <a href="https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html#Pattern-Matching">Bash Reference Manual</a> and the <a href="http://mywiki.wooledge.org/BashGuide/Patterns">Bash Guide</a> but neither mentioned this behavior. One might need to delve into the source code to say for sure what exactly is going on.</p>
<p>In comparison, Zsh and its <a href="http://zsh.sourceforge.net/Doc/Release/Expansion.html#Filename-Generation">docs</a> are much more up front about this issue:</p>
<blockquote>
<p>Note that grouping cannot extend over multiple directories: it is an error to have a &#8216;/&#8217; within a group (this only applies for patterns used in filename generation). ...</p>
</blockquote>
<p>And when we run equivalent code in Zsh:</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh">zsh-5.0.5$ <span class="kw">setopt</span> NULL_GLOB
zsh-5.0.5$ <span class="kw">echo</span> /usr/<span class="kw">(</span>bin<span class="kw">|</span>lib<span class="kw">)</span>
/usr/bin /usr/lib
zsh-5.0.5$ <span class="kw">echo</span> /usr<span class="kw">(</span>/bin<span class="kw">|</span>/lib<span class="kw">)</span>
zsh: bad pattern: /usr<span class="kw">(</span>/bin<span class="kw">|</span>/lib<span class="kw">)</span>
zsh-5.0.5$<span class="kw"> [[</span> /usr/bin <span class="ot">==</span> /usr(/bin|/lib)<span class="kw"> ]]</span> <span class="kw">&amp;&amp;</span> <span class="kw">echo</span> matching
matching<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span></code></pre></div>
<p>The lesson? Be careful not to use a pattern like <code>@(path1|path2|path3)</code> in Bash when the paths are absolute, or relative but contain the slash. Unlike Zsh, Bash just silently fails on a pattern like this, which is rather dangerous in scripts.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>Here, "a literal slash character" also applies to one that comes from tilde expansion, parameter expansion or command substitution, since they are performed before filename expansion in Bash.<a href="#fnref1">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">storyboard reached 0.1</title><link href="http://zmwangx.github.io/blog/2015-05-09-storyboard-reached-01.html" /><updated>2015-05-09T00:32:28-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-09-storyboard-reached-01.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>For quite some time I've been working on a Python project called <a href="https://github.com/zmwangx/storyboard"><code>storyboard</code></a>, and today I finally released the 0.1 stable (or you can think of it as 1.0).</p>
<p>As described on <a href="https://storyboard.readthedocs.org/en/0.1/index.html">the index page</a>,</p>
<blockquote>
<p><code>storyboard</code> is a FFmpeg-based customizable video storyboard generator with metadata reporting directly embedded in the generated images. Reported metadata fields include, but are not limited to, title, filename, file size, SHA-1 digest, container format, duration, pixel dimension, display aspect ratio (DAR), scan type (progressive, interlaced, or telecined), frame rate, and per-stream metadata (type, codec, profile, dimensions, bitrate, etc.).</p>
</blockquote>
<p>And the motivation was</p>
<blockquote>
<p><code>storyboard</code> was inspired by the storyboards I frequently encounter on video-sharing Internet forums, mostly generated by proprietary video players. Those storyboards often come with video/file metadata bundled, which I see as a great all-in-one solution for video sharing, saving one the labor of typing multiple console commands, copying and pasting output, and worrying about the forum&#8217;s crappy formatting. However, I, for one, dislike proprietary players. Also, those storyboards are usually ugly and uninformative, using stupid fonts and lacking crucial information that hackers look for (e.g., hash). Therefore, I developed this customizable storyboard generator for hackers.</p>
</blockquote>
<p>The project itself isn't very important, and I don't see any possibility of it gaining recognition; but its educational value to me was pretty huge. This is the first full package I ever developed, in the sense that it's complete with documentation, test suites, continuous integration and tested portability, as well as distributed to a package index (<a href="https://pypi.python.org/pypi/storyboard">PyPI</a> in this case). Here's what I observed and learned:</p>
<ol style="list-style-type: decimal">
<li><p>It's just really different from casual hacking, where I would try to achieve what I need in the shortest amount of programmer time possible, drop hard-coded values (even OAuth tokens) in scripts, leave things undocumented, etc. I'm a perfectionist so my casual code is usually not so bad, but <code>storyboard</code> is just different &#8212; to ensure quality of API and CLI, I wrote more documentation than actual code. Through this project I realized how hard real-world coding (or idealized real-world coding) is: the initial 10% is excitement, and the rest is just chores (compare that to casual hacking, where at least 30% is excitement).</p></li>
<li><p>Write once, debug everywhere. Not really, but ensuring portability is really difficult. Trying to debug something on a platform which I can't lay my hands upon is insanely frustrating. This afternoon I spent a long time trying to pin down a weird hanging bug on AppVeyor; the complete process is documented in <a href="https://github.com/zmwangx/storyboard/commit/e8a28e5a92f744157fedd03893fa8fe5a5e7d445">this squashed commit</a>. In the end the bug wasn't in my program, but in that specific version of FFmpeg (which I wouldn't believe since FFmpeg is really stable from my experience), or that specific version of FFmpeg combined with AppVeyor, or that specific version of FFmpeg combined with AppVeyor combined with Azure, or... who knows. The only thing I could say is it was not in my program, because I could reproduce the infinite loop in <code>ffprobe</code> even before I launched my program... Anyway, in this case I can lay my hands on the platform, just indirectly and painful. What about real world development where developers need to handle bug reports from users who could have broken everything? I don't want to imagine.</p></li>
<li><p>The project was a clear manifestation of Hofstadter's law:</p>
<blockquote>
<p>It always takes longer than you expect, even when you take into account Hofstadter's Law.</p>
</blockquote>
<p>Enough said; so true. In fact, towards the end of the development cycle I got pretty bogged down<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> and stopped for a while to work on renovating this blog (60% excitement!). Meanwhile, I was too busy with other parts of life, so I rushed towards the stable 0.1 release in the past two days, dropping several ideas I wanted to implement (for completeness). Although I "rushed", it still took at least four times as long as I expected.</p></li>
</ol>
<p>Anyway, here it is, the <a href="https://github.com/zmwangx/storyboard/releases/tag/0.1">0.1</a> <a href="https://pypi.python.org/pypi/storyboard/0.1">release</a>. The badges certainly weren't bad:</p>
<div class="figure">
<img alt="storyboard's got quite a few badges of honor" src="https://i.imgur.com/miOoX5Y.png"/>
<p class="caption"><code>storyboard</code>'s got quite a few badges of honor</p>
</div>
<p>I created <a href="https://asciinema.org/a/19782">an asciinema recording</a> to commemorate the release (the original asciicast is <a href="https://dl.bintray.com/zmwangx/generic/storyboard-0.1-walkthrough-asciicast.json">here</a>):<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a></p>
<div style="width: 672px; text-align: center; margin: auto;">
<script async="" id="asciicast-19782" src="https://asciinema.org/a/19782.js" type="text/javascript"></script>
<noscript>
Javascript disabled. Check out the cast <a href="https://asciinema.org/a/19782">here</a>.
</noscript>
</div>
<p>And, just to demonstrate <code>storyboard</code>, I re-screen-recorded the asciinema screencast with QuickTime, saved to <a href="https://dl.bintray.com/zmwangx/generic/storyboard-0.1-walkthrough.mov">an MOV file</a>, and ran it through my <code>metadata</code> and <code>storyboard</code>:</p>
<pre><code>&gt; metadata storyboard-0.1-walkthrough.mov
Filename:               storyboard-0.1-walkthrough.mov
File size:              60418244 (57.7MiB)
Container format:       QuickTime movie
Duration:               00:06:36.30
Pixel dimensions:       672x846
Display aspect ratio:   112:141
Scan type:              Progressive scan
Frame rate:             60 fps
Streams:
    #0: Video, H.264 (Main Profile level 3.2), 672x846 (DAR 112:141), 60 fps, 1213 kb/s

&gt; storyboard storyboard-0.1-walkthrough.mov
Processing storyboard-0.1-walkthrough.mov
Crunching metadata...
Trying to determine scan type...
Inspecting frame 40/40...
Generating main storyboard...
Extracting frame 16/16...
Generating thumbnail 16/16...
Tiling thumbnails...
Generating metadata sheet...
Computing SHA-1 digest...
57.7MiB 0:00:00 [ 571MiB/s] [=================================================================================&gt;] 100%
Generating promotional banner...
Assembling pieces...

storyboard saved to: /tmp/storyboard-se3fbiif.jpg
</code></pre>
<p>Here's the actual image:</p>
<div class="figure">
<img alt="storyboard of storyboard-0.1-walkthrough.mov (1964x2694), generated with the default settings by storyboard 0.1" src="https://i.imgur.com/c3E3M8R.jpg"/>
<p class="caption">storyboard of <code>storyboard-0.1-walkthrough.mov</code> (1964x2694), generated with the default settings by <code>storyboard 0.1</code></p>
</div>
<p>Credit to <code>lolcat</code> for making my storyboard colorful.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>I was implementing stuff that I wouldn't ever need myself &#8212; for completeness, and that was not rewarding in the slightest.<a href="#fnref1">&#8617;</a></p></li>
<li id="fn2"><p>The screencast's color scheme is actually off in some places, since in my iTerm2 bold font is displayed as bold, not bright.<a href="#fnref2">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">Searchable settings are one honking great idea &#8212; let's do more of those!</title><link href="http://zmwangx.github.io/blog/2015-05-06-searchable-settings-are-one-honking-great-idea-lets-do-more-of-those.html" /><updated>2015-05-06T19:29:46-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-06-searchable-settings-are-one-honking-great-idea-lets-do-more-of-those.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I had to tweak some iOS settings just now, which wasn't a delightful experience. Since I just renovated my blog inside out and am still in the hype mode, I'll write a post on the interface design of settings or preferences.</p>
<p>The Zen of Python says,</p>
<blockquote>
<p>Namespaces are one honking great idea -- let's do more of those!</p>
</blockquote>
<p>Namespaces are in general great stuff for sure, and I love them a lot.<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> But they are not so great when badly designed. One problem is that sometimes things belong to the unexpected namespace. There are already examples in Python's STL, e.g., <code>os.remove</code> and <code>shutil.rmtree</code> &#8212; for Unix guys they're just <code>rm</code> and <code>rm -r</code>, but in Python they live in two separate <del>universes</del> namespaces. The other problem is that if one takes namespaces too far and design several levels of nested namespaces, then either the names are super long and annoying to use, or one needs to leave out part of the hierarchy with <code>from .. import ..</code>, defeating the security of namespaces and making code harder to understand locally.</p>
<p>When designing an interface for settings or preferences, there are also "namespaces", or sections (and subsections), although sections are more about grouping preferences by kind than about avoiding name clashes. However, section structures more often than not suffer from the same problems as badly designed namespace structures. Take iOS Settings for example. There are both unintuitive groupings and very deep nestings.</p>
<p>Regarding unintuitive groupings, there's this top-level section named "General" (among other unintuitive things), which contains many subsections: "About", "Software Update", "Siri", "Spotlight Search", "Handoff &amp; Suggested App" "Accessibility", "Usage", "Background App Refresh"... And others I'm too tired to list. But what does "General" even mean? How are other top level sections like "Notifications", "Control Center", "Display &amp; Brightness", etc. less general than the subsections found in "General"? No clue. I think Apple just wants to put (what they perceive as) the most used sections in the top-level, but sometimes it's hard to remember what's in "General" and what's not without going through both lists one by one (and missing what you are looking for in the first three tries).</p>
<p>Regarding deep nestings, try to find "Frequent Locations". It's "Privacy-&gt;Location Services-&gt;System Services-&gt;Frequent Locations", or if you locked down Location Services with Restrictions,<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> "General-&gt;Restrictions-&gt;Location Services-&gt;System Services-&gt;Frequent Locations". Of course it's rarely used, but it still makes me gasp.<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a></p>
<p>I think in general <strong>one should be really careful with subsections (i.e., two or more levels of nesting)</strong>, especially in designing a settings interface. There's a reason why most INI files have no hierarchy, just sections. I believe the reason is that <strong>our text processing capability is inherently linear.</strong> Hypertext and jumping interfaces disrupt the linear workflow, but even when faced with a network of stuff, we still process them one at a time, linearly. Linearity is even more important in designing a settings interface since unlike reading articles, one is typically looking for a specific item. <strong>Finding one item linearly in a list of irrelevant distractions is already annoying enough, and you certainly don't want to make it quadratic or even cubic, which is simply unbearable when coupled with unexpected groupings.</strong></p>
<p>I can understand why designing a settings interface for a system as complicated as iOS (yet somehow has to keep all settings in a central place) is hard &#8212; there are too many atomic items, and often items do not fall nicely into categories. But I think it still important to try to reduce nesting. Maybe having long lists, but putting the most commonly used items on top is a good idea. Or maybe... Bypass the linear searching experience altogether?</p>
<h2 id="searchable-settings">Searchable settings</h2>
<p>I'm not sure who invented searchable setting pages, but I first noticed their great efficiency in Google Chrome many years ago, when one had to look for setting items tab after tab in all other major browsers. In fact, even to this day, the Chromium Opera (i.e., Opera 15+) is the only major browser other than Chrome that has adopted searchable settings. (I remember arguing with someone over whether this was a change for the good on <a href="http://blogs.opera.com/desktop/">blogs.opera.com/desktop</a>.) Searchable settings is also available in OS X's System Preferences, which is a joy to use. See screenshots below about how Google and Apple implement a searchable interface. Windows Control Panel is also searchable, and the search feature is capable of turning up deeply buried settings (e.g., "Control Panel-&gt;System and Security-&gt;System-&gt;Advanced system settings-&gt;Environment Variables"), so one point for them also.</p>
<p>As I said above, looking for an item in a list of irrelevant stuff is really annoying. Searchable settings completely bypass this issue by bringing users right to the desired item. This way, unintuitive groupings or deep nestings are no longer that problematic. Just like Google will tell me whether <code>rmtree</code> is in <code>os</code> or <code>shutil</code><a class="footnoteRef" href="#fn4" id="fnref4"><sup>4</sup></a>, System Preferences' search will tell me whether "Dark menu bar or Dock" is in "General" or somewhere else.</p>
<p>In fact, it is somewhat surprising to me that searchable settings are only available in a handful of applications. Seriously, these days we can search for almost anything on our computers and anything on the grand grand Internet, but we can't search the pool of available settings? If we have an INI, Plist XML, JSON, YAML, or whatever text configuration/preference file, then we can search it. Why not in GUI applications?</p>
<p>Of course, designing clear structures (with the principles and pitfalls discussed in the first half of this post) pays. But searchable settings are one honking great idea, and they are just long due in most applications. Come on, let's do more of them.</p>
<div class="figure">
<img alt="How Google designed their award-winning searchable settings." src="https://i.imgur.com/NazieEk.png"/>
<p class="caption">How Google designed their award-winning searchable settings.</p>
</div>
<div class="figure">
<img alt="Apple." src="https://i.imgur.com/aKgW29W.png"/>
<p class="caption">Apple.</p>
</div>
<div class="figure">
<img alt="Microsoft." src="https://i.imgur.com/7zJxr8P.png"/>
<p class="caption">Microsoft.</p>
</div>
<hr/>
<p><strong>May 16, 2015 update:</strong> Ars Technica <a href="http://arstechnica.com/apple/2015/05/what-wed-like-to-see-in-ios-9-at-wwdc-next-month/">published an article today</a> listing "what we'd like to see in iOS 9 at WWDC next month", and "Settings page overhaul" is listed as the third item. Apparently I'm not the only one who's concerned about the iOS Settings maze. In addition, their proposed solution is similar to mine;<a class="footnoteRef" href="#fn5" id="fnref5"><sup>5</sup></a> the key, of course, is search.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>Thinking about <a href="http://nshipster.com/namespacing/"><code>NSHell</code></a> and the like kinda creeps me out, although there are quite some reasonable pro-class prefix arguments.<a href="#fnref1">&#8617;</a></p></li>
<li id="fn2"><p>Which you should: what's the point of Find My iPhone when the thief can disable it in Location Services?<a href="#fnref2">&#8617;</a></p></li>
<li id="fn3"><p>This brings another problem of the interface design of iOS Settings. When restricted, one cannot make modifications to "Privacy-&gt;Location Services", and instead has to go to "General-&gt;Restrictions-&gt;Location Services". What's the point? "Restrictions" is about <em>setting restrictions</em>, not about <em>editing restricted items or sections in a central place exclusively"</em>. Ideally one should be able to tap on a lock icon in "Privacy-&gt;Location Services" and enter the restrictions passcode to unlock it, like what we find in OS X's System Preferences.<a href="#fnref3">&#8617;</a></p></li>
<li id="fn4"><p>This is of course just a metaphor; I'm not dumb enough to be unable to remember <code>shutil.rmtree</code>.<a href="#fnref4">&#8617;</a></p></li>
<li id="fn5"><p>Which is not at all surprising, since Apple's very own OS X has already set an example.<a href="#fnref5">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">Graceful handling of SIGINT when using Python's multiprocessing.Process</title><link href="http://zmwangx.github.io/blog/2015-05-05-graceful-handling-of-sigint-when-using-pythons-multiprocessingprocess.html" /><updated>2015-05-05T22:03:39-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-05-graceful-handling-of-sigint-when-using-pythons-multiprocessingprocess.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Today I learned something about Python's (at least CPython's) multiprocessing and signal handling, and I would like to share it here. Basically my situation was such (when developing <a href="https://github.com/zmwangx/zmwangx.github.io/blob/source/pyblog"><code>pydoc</code></a> that powers this blog):</p>
<ul>
<li>I would like to serve the blog with an HTTP server while auto-regenerating for changes;</li>
<li>The auto-regeneration is handled in the main process with a while loop, whereas the HTTP server (requiring little human intervention) is put in a <code>multiprocessing.Process</code> and launched with <code>http.server.HTTPServer.serve_forever()</code>;</li>
<li>Upon sending <code>SIGINT</code>, both processes need to clean up and quit; in particular, the server needs to exit its <code>serve_forever()</code> loop (which can be done via <code>shutdown()</code>, but how to invoke the method is a problem, since <code>serve_forever()</code> blocks);</li>
<li>Handling of <code>SIGINT</code> must be graceful in the main process &#8212; there might be an ongoing build that must not be interrupted until finishing.</li>
</ul>
<p>Given this context, I learned the following two critical concepts (at least true in the current version of CPython) through trial and error:</p>
<ol style="list-style-type: decimal">
<li><strong>A user-triggered <code>SIGINT</code> is sent to both processes</strong> &#8212; the main process and the <code>multiprocessing.Process</code> instance;</li>
<li><strong>Except for the defined interfaces, a <code>multiprocessing.Process</code> instance is almost completely separated from the main process, sharing as little resources as possible</strong>; by "defined interfaces" I mean the defined attributes and methods of a <code>Process</code> instance, as well as defined communication channels like <code>multiprocessing.Pipe</code> or <code>multiprocessing.Queue</code>. And to expand on resource sharing: yes, the two processes have their own copies of global variables, so using global variables as state registers is a no-go.</li>
</ol>
<p>Both concepts can be used to one's benefit or detriment. Below is how I solved my problem, using the two concepts. Observe that without a custom handler, Python translates a <code>SIGINT</code> to a <code>KeyboardInterrupt</code> exception; therefore, I use the default <code>KeyboardInterrupt</code> to interrupt the HTTP server in its own process (through handling the exception and calling <code>shutdown()</code>), but instead install a custom <code>SIGINT</code> handler in the main process that translates <code>SIGINT</code> to setting a <code>sigint_raised</code> flag that can be picked up by the while loop once the current build (if any) is finished. The proof of concept script is as follows (the production code is <a href="https://github.com/zmwangx/zmwangx.github.io/blob/a7a0b2073f30b1d0214c3152998d95e40a39b438/pyblog#L567-L635">here</a>):</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co">#!/usr/bin/env python3</span>

<span class="ch">import</span> http.server
<span class="ch">import</span> multiprocessing
<span class="ch">import</span> signal
<span class="ch">import</span> sys
<span class="ch">import</span> time

<span class="kw">class</span> HTTPServerProcess(multiprocessing.Process):
    <span class="kw">def</span> run(<span class="ot">self</span>):
        httpd = http.server.HTTPServer(
            (<span class="st">""</span>, <span class="dv">8000</span>), http.server.SimpleHTTPRequestHandler)
        <span class="kw">try</span>:
            httpd.serve_forever()
        <span class="kw">except</span> <span class="ot">KeyboardInterrupt</span>:
            httpd.shutdown()

<span class="kw">def</span> do_things():
    <span class="kw">for</span> i in <span class="dt">range</span>(<span class="dv">10</span>):
        sys.stderr.write(<span class="st">"."</span>)
        sys.stderr.flush()
        time.sleep(<span class="dv">1</span>)
    sys.stderr.write(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)

<span class="kw">def</span> main():
    server_process = HTTPServerProcess()
    server_process.start()

    <span class="co"># define and install custom SIGINT handler</span>
    sigint_raised = <span class="ot">False</span>

    <span class="kw">def</span> sigint_mitigator(signum, frame):
        <span class="kw">nonlocal</span> sigint_raised
        sigint_raised = <span class="ot">True</span>

    signal.signal(signal.SIGINT, sigint_mitigator)

    <span class="kw">while</span> not sigint_raised:
        do_things()

    server_process.join()

<span class="kw">if</span> <span class="ot">__name__</span> == <span class="st">"__main__"</span>:
    main()<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span><span class="line-number" data-line="9" style="top: 144px"><!----></span><span class="line-number" data-line="10" style="top: 162px"><!----></span><span class="line-number" data-line="11" style="top: 180px"><!----></span><span class="line-number" data-line="12" style="top: 198px"><!----></span><span class="line-number" data-line="13" style="top: 216px"><!----></span><span class="line-number" data-line="14" style="top: 234px"><!----></span><span class="line-number" data-line="15" style="top: 252px"><!----></span><span class="line-number" data-line="16" style="top: 270px"><!----></span><span class="line-number" data-line="17" style="top: 288px"><!----></span><span class="line-number" data-line="18" style="top: 306px"><!----></span><span class="line-number" data-line="19" style="top: 324px"><!----></span><span class="line-number" data-line="20" style="top: 342px"><!----></span><span class="line-number" data-line="21" style="top: 360px"><!----></span><span class="line-number" data-line="22" style="top: 378px"><!----></span><span class="line-number" data-line="23" style="top: 396px"><!----></span><span class="line-number" data-line="24" style="top: 414px"><!----></span><span class="line-number" data-line="25" style="top: 432px"><!----></span><span class="line-number" data-line="26" style="top: 450px"><!----></span><span class="line-number" data-line="27" style="top: 468px"><!----></span><span class="line-number" data-line="28" style="top: 486px"><!----></span><span class="line-number" data-line="29" style="top: 504px"><!----></span><span class="line-number" data-line="30" style="top: 522px"><!----></span><span class="line-number" data-line="31" style="top: 540px"><!----></span><span class="line-number" data-line="32" style="top: 558px"><!----></span><span class="line-number" data-line="33" style="top: 576px"><!----></span><span class="line-number" data-line="34" style="top: 594px"><!----></span><span class="line-number" data-line="35" style="top: 612px"><!----></span><span class="line-number" data-line="36" style="top: 630px"><!----></span><span class="line-number" data-line="37" style="top: 648px"><!----></span><span class="line-number" data-line="38" style="top: 666px"><!----></span><span class="line-number" data-line="39" style="top: 684px"><!----></span><span class="line-number" data-line="40" style="top: 702px"><!----></span><span class="line-number" data-line="41" style="top: 720px"><!----></span><span class="line-number" data-line="42" style="top: 738px"><!----></span><span class="line-number" data-line="43" style="top: 756px"><!----></span><span class="line-number" data-line="44" style="top: 774px"><!----></span></code></pre></div>
<p>Beware that with this solution, if there are external programs or OS level operations happening in the main process, then the operation at the time of <code>SIGINT</code> will still be interrupted<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> (for example, in the script above, the <code>time.sleep(1)</code> at the exact point of <code>SIGINT</code> is still interrupted, but otherwise <code>do_things</code> is carried on to its completion). I'm not sure how to explain this &#8212; maybe the handler isn't capturing the signal fast enough?<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> Anyway, one single early interruption is at least more acceptable than a completely corrupted build<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a>, and certainly more graceful.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p><a href="https://hg.python.org/cpython/file/1320ec1b24af/Modules/_multiprocessing">CPython's <code>multiprocessing</code> is written in C</a>, so the behavior might depend on the OS. I'm talking about OS X here. I haven't inspected and won't inspect the C source code.<a href="#fnref1">&#8617;</a></p></li>
<li id="fn2"><p>That's awfully naive and layman-sounding, I know, but I <em>am</em> almost a layman when it comes to system-level programming.<a href="#fnref2">&#8617;</a></p></li>
<li id="fn3"><p>That's assuming your build isn't interdependent in which any single failure corrupts everything. In that case, what can we do? I honestly see no way of injecting signal handling in <code>subprocess.Popen</code>.<a href="#fnref3">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">New blog, new start</title><link href="http://zmwangx.github.io/blog/2015-05-05-new-blog-new-start.html" /><updated>2015-05-05T02:42:44-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-05-new-blog-new-start.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Octopress has been serving me for the past six months, during which even Octopress itself underwent major changes &#8212; in fact, <a href="https://github.com/octopress/octopress/releases/tag/v3.0.0">Octopress 3.0.0</a> was only released 3 days ago, which I never got to try. Anyway, Octopress's heavily colored interface grew old on me fairly quickly. I'm especially unhappy with the inline <code>&lt;code&gt;</code> tag, which is always wrapped in a white box and stands out too much (worse still, there's no visual difference when such a <code>&lt;code&gt;</code> tag is placed inside an <code>&lt;a&gt;</code> tag). Since I use inline code/verbatim a lot, many of my articles were littered with arbitrary boxes everywhere.</p>
<div class="figure">
<img alt="Farewell, Octopress." src="https://i.imgur.com/hxfSnOk.png"/>
<p class="caption">Farewell, Octopress.</p>
</div>
<p>Apparently I need something simpler. Because</p>
<blockquote>
<p>Simplicity is the ultimate sophistication.</p>
</blockquote>
<p>But how? Simiplicity 101: get rid of the "platform". There's no reason why I need a blogging platform like Jekyll (let alone the WordPress monster). When I initially switched to Octopress, I thought code highlighting was something fancy that I need heavy machinery to achieve, but it turned out that Pandoc is battery-included when it comes to syntax highting,<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> so all I need is to specify a highlight style, e.g., Pygments:</p>
<pre><code>pandoc input.md --highlight-style=pygments --template template.html --output output.html</code></pre>
<p>That's it. Write the Markdown, compile with Pandoc, instantly awesome. So the HTML posts are there (assuming the HTML template is written, which is not hard to kick off).</p>
<p>The rest of the job is to design the stylesheets and compile the posts into a coherent blog &#8212; basically, generate an index. I was able to realize both in several hours. For the former task, I borrowed a lot from <a href="http://mort.ninja/">mort.ninja</a> by <a href="https://github.com/soimort">Mort Yao</a>. Interestingly, we were born in the same city (Nanjing, China), and I benefit from at least two of his open source projects: <a href="https://github.com/soimort/you-get">you-get</a> and <a href="https://github.com/soimort/translate-shell">translate-shell</a>. The latter task is more interesting but also not hard. I'm rolling my own toolchain in Python, which you can find in <a href="https://github.com/zmwangx/zmwangx.github.io/blob/source/pyblog"><code>pyblog</code></a>. In fact, the complete source of this blog (down to how image assets are generated) are in the <a href="https://github.com/zmwangx/zmwangx.github.io/tree/source"><code>source</code> branch</a> of my GitHub Pages repo, so you may take a look if you're interested. <code>pyblog</code> is highly specialized<a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> and is still a work in progress at the time of writing, but it's already well capable of generating the blog &#8212; currently missing are auto gen-deploy and preview (with auto-update), which will also come soon.</p>
<p>By the way, the most annoying thing in the development process was working with XML and generating <a href="/atom.xml">the Atom feed</a>. Standard library <code>xml.etree.ElementTree</code> doesn't support the <code>![CDATA[</code> tag, and in the end I had to hack <a href="https://github.com/zmwangx/zmwangx.github.io/blob/source/pyblog#L34-L54">library internals</a>, which is likely to break in future versions. Remember the quotes?</p>
<blockquote>
<p>XML is a classic political compromise: it balances the needs of man and machine by being equally unreadable to both.</p>
</blockquote>
<blockquote>
<p>XML combines the efficiency of text files with the readability of binary files.</p>
</blockquote>
<p>Sigh.</p>
<p>Anyway, here is my new shiny blog.</p>
<div class="figure">
<img alt="Welcome to the completely revamped dl? cmplnts?" src="https://i.imgur.com/VS5f9eJ.png"/>
<p class="caption">Welcome to the completely revamped dl? cmplnts?</p>
</div>
<p>It looks ten times better than Octopress, and ever builds much faster than Octopress<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a>. As a bonus, the codebase is so small that it's super trivial to hack (no, not <em>that</em> hack).</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>Well, Pandoc is heavy-machinery, but it's both generic and self-contained, unlike a specialized blogging platform.<a href="#fnref1">&#8617;</a></p></li>
<li id="fn2"><p>Which is fine since I don't expect anyone else to use it, anyway.<a href="#fnref2">&#8617;</a></p></li>
<li id="fn3"><p>I have the impression that a complete build of all posts (about fifty of them) with <code>pyblog</code> is faster than regenerating for a single modified post in Octopress. That's in the context of absolutely no categories; when you have a dozen or more categories, Octopress slows down to a halt.<a href="#fnref3">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">Why Oh My Zsh is completely broken</title><link href="http://zmwangx.github.io/blog/2015-05-03-why-oh-my-zsh-is-completely-broken.html" /><updated>2015-05-03T17:15:49-07:00</updated><id>http://zmwangx.github.io/blog/2015-05-03-why-oh-my-zsh-is-completely-broken.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Today I moved from <a href="https://github.com/robbyrussell/oh-my-zsh">Oh My Zsh</a> to <a href="https://github.com/sorin-ionescu/prezto">Prezto</a>, after using Oh My Zsh for about three years since 2012. I'll try to shed some light on the reasons in this post.</p>
<p>Zsh is a rather complicated shell (compared to Bash), with a hell lot of builtins and a complex completion system. The complexity makes it powerful, but also makes it intimidating to mortals; moreover, it doesn't look as sweet as it could be out of box. Most mortals, me included, want an interactive shell that's sweet and "just works", so we need wizards to guide us in configuring this beast. Oh My Zsh and Prezto are just two of such configuration frameworks. Oh My Zsh is somewhat older: the first commit of Oh My Zsh dates back to <a href="https://github.com/robbyrussell/oh-my-zsh/commit/e20401e04e057a39c228dbb99dda68ec7fa4235a">August 2009</a>, while Prezto was forked from Oh My Zsh in <a href="https://github.com/sorin-ionescu/prezto/commit/8d487d4f6c2d38cb108d7c8c0c2de9f0385da402">February 2011</a>, and has since been completely rewritten. <code>robbyrussell/oh-my-zsh</code> as of today has 23,610 stars on GitHub, while <code>sorin-ionescu/prezto</code> has 4,069. This doesn't imply Oh My Zsh is any better &#8212; I guess the fancy name of Oh My Zsh earned it a lot more undeserved stars; you'll see why soon.</p>
<p>I was hardly involved in Oh My Zsh development, and I haven't even carefully inspected Oh My Zsh's source code until yesterday, so my soon-to-come complaints about Oh My Zsh might not be completely true. But here it is: <strong>Oh My Zsh brings the worst of community-driven development, where the "community" knows not of what it is doing, and just wants to get things done in the sloppiest way possible.</strong> Let's look at some examples. All discussions are based on <a href="https://github.com/robbyrussell/oh-my-zsh/commit/140034605edd0f72c548685d39e49687a44c1b23"><code>1400346</code></a>, the latest commit at the time of writing.</p>
<h2 id="the-core-lib-hodgepodge">The core lib hodgepodge</h2>
<p>First, look at Oh My Zsh's core <a href="https://github.com/robbyrussell/oh-my-zsh/tree/140034605edd0f72c548685d39e49687a44c1b23/lib">lib</a>:</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="kw">&gt;</span> <span class="kw">ls</span> lib
bzr.zsh         directories.zsh  grep.zsh          misc.zsh                   spectrum.zsh
completion.zsh  functions.zsh    history.zsh       nvm.zsh                    termsupport.zsh
correction.zsh  git.zsh          key-bindings.zsh  prompt_info_functions.zsh  theme-and-appearance.zsh<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span></code></pre></div>
<p>Wait, why do I see <code>bzr.zsh</code>, <code>git.zsh</code>, and even <code>nvm.zsh</code> in the core lib? Why are all of these mandatory (all files in <code>lib</code> are sourced from <code>oh-my-zsh.sh</code>)? Why should I load <code>bzr.sh</code> and <code>nvm.zsh</code> when I don't use Bazaar or NVM at all?<a class="footnoteRef" href="#fn1" id="fnref1"><sup>1</sup></a> Moreover, since we already have <code>bzr.sh</code>, <code>git.zsh</code> and <code>nvm.zsh</code> in the core library, why don't we also have <code>hg.zsh</code>, <code>rvm.zsh</code>, <code>svn.zsh</code> and <code>virtualenv.zsh</code>, just to name a few?</p>
<p>I suppose these marginal scripts are in the core because they define functions (<code>bzr_prompt_info</code>, <code>git_prompt_info</code>, <code>nvm_prompt_info</code>, etc.) that are called from many themes; well, at least this is the case for <code>git.zsh</code>. But that doesn't answer any of the questions above. <strong>The underlying question is: why aren't they simply plugins?</strong><a class="footnoteRef" href="#fn2" id="fnref2"><sup>2</sup></a> Loading a plugin in Oh My Zsh isn't sophiscated at all (compared to Prezto; see discussion below), just annoying to type in full, which <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/oh-my-zsh.sh#L68-L72">boils down to</a>:</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="kw">if [</span> <span class="ot">-f</span> <span class="ot">$ZSH_CUSTOM</span>/plugins/<span class="ot">$plugin</span>/<span class="ot">$plugin</span>.plugin.zsh<span class="kw"> ]</span>; <span class="kw">then</span>
    <span class="kw">source</span> <span class="ot">$ZSH_CUSTOM</span>/plugins/<span class="ot">$plugin</span>/<span class="ot">$plugin</span>.plugin.zsh
<span class="kw">elif [</span> <span class="ot">-f</span> <span class="ot">$ZSH</span>/plugins/<span class="ot">$plugin</span>/<span class="ot">$plugin</span>.plugin.zsh<span class="kw"> ]</span>; <span class="kw">then</span>
    <span class="kw">source</span> <span class="ot">$ZSH</span>/plugins/<span class="ot">$plugin</span>/<span class="ot">$plugin</span>.plugin.zsh
<span class="kw">fi</span><span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span></code></pre></div>
<p>where <code>$plugin</code> is the name of the plugin. They can easily wrap this in a function and let theme authors painlessly load plugins,<a class="footnoteRef" href="#fn3" id="fnref3"><sup>3</sup></a> but they just don't. Also, the consistency issue (think of my question about <code>hg</code>, <code>rvm</code>, <code>svn</code> and <code>virtualenv</code>) is beyond my grasp. The only way I could make sense of this situation is that all the mess was created by clueless community contributions that didn't think about the code base as a whole (the code base is small!), and maintainers didn't care either.</p>
<p>Meanwhile, Prezto does it right. Prezto is highly modular, with the <code>pmodload</code> function defined in <a href="https://github.com/sorin-ionescu/prezto/blob/08676a273eba1781ddcb63c4f89cfff9bd62eac4/init.zsh"><code>init.zsh</code></a> to load modules (doing things like sourcing module init scripts and marking module functions for autoloading). That's about the entirety of Prezto's core; everything else are in optional <a href="https://github.com/sorin-ionescu/prezto/blob/08676a273eba1781ddcb63c4f89cfff9bd62eac4/modules">modules</a>, including essential configs like <code>editor</code> (ZLE configs), <code>completion</code>, and <code>prompt</code>. Note that module loading order matters in some cases, but still, working with Prezto's modular structure is a joy. Apart from <code>init.zsh</code> and the <code>modules</code> directory, the Prezto repo does contain one other <a href="https://github.com/sorin-ionescu/prezto/tree/08676a273eba1781ddcb63c4f89cfff9bd62eac4/runcoms"><code>runcoms</code></a> directory with rc files, but those are just recommendations that one may safely ignore. In fact, there are a total of eight lines related to Prezto in my <code>.zshrc</code>, and nowhere else (note that I only switched to Prezto today, so this freshly baked <code>.zshrc</code> is subject to change):</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="co"># prezto</span>
<span class="kw">zstyle</span> <span class="st">':prezto:*:*'</span> color <span class="st">'yes'</span>
<span class="kw">zstyle</span> <span class="st">':prezto:environment:termcap'</span> color <span class="st">'no'</span> <span class="co"># disable coloring of less, which looks horrible</span>
<span class="kw">zstyle</span> <span class="st">':prezto:load'</span> pmodule environment editor <span class="kw">history</span> directory utility colors spectrum git completion prompt ruby
<span class="kw">zstyle</span> <span class="st">':prezto:module:editor'</span> key-bindings <span class="st">'emacs'</span>
<span class="kw">zstyle</span> <span class="st">':prezto:module:prompt'</span> theme <span class="st">'zmwangx'</span>
<span class="kw">[[</span> <span class="st">"</span><span class="ot">$OSTYPE</span><span class="st">"</span> <span class="ot">==</span> darwin*<span class="kw"> ]]</span> <span class="kw">&amp;&amp;</span> <span class="kw">export</span> <span class="ot">BROWSER=</span><span class="st">'open'</span>
<span class="kw">source</span> ~/.zprezto/init.zsh<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span></code></pre></div>
<p>Here <code>zmwangx</code> is my <a href="https://github.com/zmwangx/prezto/blob/master/modules/prompt/functions/prompt_zmwangx_setup">personal theme</a> that looks like <a href="https://i.imgur.com/nCBK8ZB.png">this</a>.</p>
<h2 id="incredibly-poor-code-quality">Incredibly poor code quality</h2>
<p>Oh My Zsh's code quality is incredibly poor. Even within the core library. Pick any file from <code>lib/</code>, and you'll be amazed by the hot mess in front of your eyes. There's no coding standard whatsoever:</p>
<ul>
<li>You can find four-space indents and two-space indents mixed <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/functions.zsh">in the same file</a>;</li>
<li>You can find function definitions with the <code>function</code> keyword and without <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/git.zsh">in the same file</a>;</li>
<li>You can find <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/functions.zsh#L2">167-character-long lines</a> mixed with early-broken lines (yes, sometimes <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/git.zsh#L69">in the same file</a>);</li>
<li>You can find completely commented out blocks of code <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/key-bindings.zsh#L70-L87">in the core lib</a>, where the average user is not supposed to touch;</li>
</ul>
<p>I guess the list could go on; I didn't spend more time inspecting this crap.</p>
<p>We were discussing styles, but obviously style isn't the only problem with this code base. Next onto a case study of how Oh My Zsh does something in the most inefficient way possible. Let's have a look at <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/git.zsh"><code>git.zsh</code></a>. It suffers from almost all problems we have talked about so far, but let's focus specifically on <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/git.zsh#L78-L122">the <code>git_prompt_status</code> function</a>:</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="fu">git_prompt_status()</span> <span class="kw">{</span>
  <span class="ot">INDEX=$(</span><span class="kw">command</span> git status --porcelain -b <span class="kw">2&gt;</span> /dev/null<span class="ot">)</span>
  <span class="ot">STATUS=</span><span class="st">""</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">command</span> <span class="kw">grep</span> -E <span class="st">'^\?\? '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_UNTRACKED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^A  '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_ADDED$STATUS</span><span class="st">"</span>
  <span class="kw">elif</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^M  '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_ADDED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^ M '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_MODIFIED$STATUS</span><span class="st">"</span>
  <span class="kw">elif</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^AM '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_MODIFIED$STATUS</span><span class="st">"</span>
  <span class="kw">elif</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^ T '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_MODIFIED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^R  '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_RENAMED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^ D '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_DELETED$STATUS</span><span class="st">"</span>
  <span class="kw">elif</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^D  '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_DELETED$STATUS</span><span class="st">"</span>
  <span class="kw">elif</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^AD '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_DELETED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">command</span> git rev-parse --verify refs/stash <span class="kw">&gt;</span>/dev/null <span class="kw">2&gt;&amp;1</span><span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_STASHED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^UU '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_UNMERGED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^## .*ahead'</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_AHEAD$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^## .*behind'</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_BEHIND$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">if</span> <span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^## .*diverged'</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span>; <span class="kw">then</span>
    <span class="ot">STATUS=</span><span class="st">"</span><span class="ot">$ZSH_THEME_GIT_PROMPT_DIVERGED$STATUS</span><span class="st">"</span>
  <span class="kw">fi</span>
  <span class="kw">echo</span> <span class="ot">$STATUS</span>
<span class="kw">}</span><span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span><span class="line-number" data-line="9" style="top: 144px"><!----></span><span class="line-number" data-line="10" style="top: 162px"><!----></span><span class="line-number" data-line="11" style="top: 180px"><!----></span><span class="line-number" data-line="12" style="top: 198px"><!----></span><span class="line-number" data-line="13" style="top: 216px"><!----></span><span class="line-number" data-line="14" style="top: 234px"><!----></span><span class="line-number" data-line="15" style="top: 252px"><!----></span><span class="line-number" data-line="16" style="top: 270px"><!----></span><span class="line-number" data-line="17" style="top: 288px"><!----></span><span class="line-number" data-line="18" style="top: 306px"><!----></span><span class="line-number" data-line="19" style="top: 324px"><!----></span><span class="line-number" data-line="20" style="top: 342px"><!----></span><span class="line-number" data-line="21" style="top: 360px"><!----></span><span class="line-number" data-line="22" style="top: 378px"><!----></span><span class="line-number" data-line="23" style="top: 396px"><!----></span><span class="line-number" data-line="24" style="top: 414px"><!----></span><span class="line-number" data-line="25" style="top: 432px"><!----></span><span class="line-number" data-line="26" style="top: 450px"><!----></span><span class="line-number" data-line="27" style="top: 468px"><!----></span><span class="line-number" data-line="28" style="top: 486px"><!----></span><span class="line-number" data-line="29" style="top: 504px"><!----></span><span class="line-number" data-line="30" style="top: 522px"><!----></span><span class="line-number" data-line="31" style="top: 540px"><!----></span><span class="line-number" data-line="32" style="top: 558px"><!----></span><span class="line-number" data-line="33" style="top: 576px"><!----></span><span class="line-number" data-line="34" style="top: 594px"><!----></span><span class="line-number" data-line="35" style="top: 612px"><!----></span><span class="line-number" data-line="36" style="top: 630px"><!----></span><span class="line-number" data-line="37" style="top: 648px"><!----></span><span class="line-number" data-line="38" style="top: 666px"><!----></span><span class="line-number" data-line="39" style="top: 684px"><!----></span><span class="line-number" data-line="40" style="top: 702px"><!----></span><span class="line-number" data-line="41" style="top: 720px"><!----></span><span class="line-number" data-line="42" style="top: 738px"><!----></span><span class="line-number" data-line="43" style="top: 756px"><!----></span><span class="line-number" data-line="44" style="top: 774px"><!----></span><span class="line-number" data-line="45" style="top: 792px"><!----></span></code></pre></div>
<p><strong>This one single function intended to be invoked from a precmd hook (basically executed every time the prompt is printed), calls <code>grep</code> a staggering 14 times inside command substitutions, forking the process 28 times &#8212; while all the greps can be replaced with pattern/regex matching right within the shell.</strong> (Keep in mind that forking is the most expensive operation of the shell.) For instance,</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="ot">$(</span><span class="kw">echo</span> <span class="st">"</span><span class="ot">$INDEX</span><span class="st">"</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">'^A  '</span> <span class="kw">&amp;&gt;</span> /dev/null<span class="ot">)</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>may well be replaced with</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="kw">[[</span> <span class="ot">$INDEX</span> <span class="ot">==</span> *<span class="st">$'</span><span class="dt">\n</span><span class="st">A  '</span>*<span class="kw"> ]]</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="kw">[[</span> <span class="ot">$INDEX</span> =~ <span class="st">$'</span><span class="dt">\n</span><span class="st">A  '</span><span class="kw"> ]]</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>(Note that the <code>git status --porcelain -b</code> call always prints the branch info such as <code>## master...origin/master</code> in the first line, so "<code>A </code>", if present at the beginning of any line, must be preceded by a newline; that's why the above works.) All other grep calls can be similarly replaced with pattern/regex matching. No forking.</p>
<p>By the way, whoever wrote this function seems to be unaware of the <code>-q,--quite,--silent</code> switch of <code>grep</code> (which should be available in all implementations), and every call is littered with <code>&amp;&gt; /dev/null</code>. In fact, using the <code>-q</code> switch is even (slightly) faster: a reasonable implementation of <code>-q</code> exits immediately when a match is found, while what is written here waits until all input is processed.</p>
<p>I haven't exhausted the problems with this function just yet. As a bonus: despite being awfully inefficient, <strong>this function <em>can't even be used</em> in many cases for which it is designed.</strong> You might have noticed that the order of different status bits is completely fixed by whoever wrote this function (by the way, all those <code>$ZSH_THEME_GIT_PROMPT_*</code> variables are documented nowhere, so one who wants to write a theme has to dig into the source &#8212; only to find the function useless expect for polluting the namespace). If one wants to use a different order, or put some of the bits in <code>RPROMPT</code>, one has to roll his own (or good luck parsing the output of <code>git_prompt_status</code>). In fact, even a <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/lib/git.zsh#L2-L8">dumbed down function <code>git_prompt_info</code></a>, which only prints the branch name and whether it's dirty, is similarly uncustomizable; <a href="https://github.com/robbyrussell/oh-my-zsh/blob/140034605edd0f72c548685d39e49687a44c1b23/themes/gallois.zsh-theme">the <code>gallois</code> theme</a>, my first theme and on which I later based my own theme, needs to define a <code>git_custom_status</code> function to achieve what it needs &#8212; otherwise something as simple as adding a pair of brackets around the branch name is super painful.</p>
<p>One might wonder how Prezto solves the same problem. The answer is in <a href="https://github.com/sorin-ionescu/prezto/blob/08676a273eba1781ddcb63c4f89cfff9bd62eac4/modules/git/functions/git-info"><code>modules/git/functions/git-info</code></a>. The <code>git-info</code> function does more, and again in a highly modular way (without grep calls, for God's sake): status bits or their combinations are <a href="https://github.com/sorin-ionescu/prezto/blob/08676a273eba1781ddcb63c4f89cfff9bd62eac4/modules/git/functions/git-info#L393-L416">formatted on demand with <code>zformat</code> and stored in an associative array <code>git_info</code></a>, where users specify format strings via <code>zstyle</code> with <a href="https://github.com/sorin-ionescu/prezto/tree/08676a273eba1781ddcb63c4f89cfff9bd62eac4/modules/git#theming">thoroughly documented escape sequences</a>. Very beautiful solution.</p>
<h2 id="the-completely-broken-community-contribution-process">The completely broken community contribution process</h2>
<p>I'm not sure if the project maintainers are Zsh wizards (I'm afraid not). I'll just assume that most of the code with incredibly poor quality came from community contribution. Okay, community. But even the community contribution process is completely broken.</p>
<p>At the time of writing there are 159 open issues and 446 open pull requests in <code>robbyrussell/oh-my-zsh</code> (the stats are 13/35 in <code>sorin-ionescu/prezto</code> &#8212; not proportional to the number of stars or forks). There's even <a href="https://github.com/robbyrussell/oh-my-zsh/pull/3809">a PR called "Easy-to-Merge"</a> that is said to collect PRs that are either extremely simple fixes or have been discussed&#8211;tested&#8211;and&#8211;signed-off (wait, then why aren't they already merged?). This makes it almost impossible to open new, substantial PRs (such as a complete rewrite of the <code>git_prompt_status</code> criticized above) &#8212; God knows whether other people have already proposed the same fix, or a different fix for the same problem, whether it's been discussed&#8211;tested&#8211;and&#8211;signed-off, and how much discussion will be needed for a new PR.</p>
<p>You might infer from the above that the actually merged PRs are discussed&#8211;tested&#8211;and&#8211;signed-off. Well, of course not (think about the code quality), and here's one more case study.</p>
<p>The only time I <a href="https://github.com/robbyrussell/oh-my-zsh/pull/3591">submitted a PR</a> is when <a href="https://github.com/robbyrussell/oh-my-zsh/pull/3564">a previous PR</a> broke aliases of the <code>ls</code> family, which most of us run tens to hundreds of times every day. The <code>-h</code> option was stripped from all aliases but one (which was ridiculous since the option seemed to be lost during copy/paste), and anyone who used the affected aliases regularly and lived with the PR for ten minutes should notice. Apparently nobody looked at the diffs before merging, or nobody cared (before I and one other guy jumped in). My PR was merged three days later; the delay was okay.</p>
<p><a href="https://github.com/robbyrussell/oh-my-zsh/pull/3341">In another instance</a>, the delay was totally unbearable. <a href="https://savannah.gnu.org/forum/forum.php?forum_id=8152">grep 2.21</a> was released on November 23, 2014, and it deprecated <code>GREP_OPTIONS</code>. Oh My Zsh was using <code>GREP_OPTIONS</code> back then, so anyone who upgraded to grep 2.21 and used grep regularly was getting a lot of deprecation warnings (oh, before you ask, <code>grep.zsh</code> is in the core lib). Core lib stuff spitting deprecation warnings on all platforms all the time is a pretty big thing, right? There were multiple ways to fix this problem, all of them trivial to the reasonably trained eyes; and they won't break user scripts, unless someone was doing something insane in the first place (like relying on exported <code>GREP_OPTIONS</code> for certain behaviors in a script). However, there were quite a bit of discussion spanning multiple issues and PRs (most notably <a href="https://github.com/robbyrussell/oh-my-zsh/pull/3341">this one</a>), and despite all the discussions, not a single maintainer or collaborator joined or showed any interest. <a href="https://github.com/robbyrussell/oh-my-zsh/pull/3403">A fix was merged not until December 14, 2014</a>. Of course there were temporary fixes (remember, the issue was trivial to begin with), but the problem must have been confusing to the less-proficient Zsh users during the twenty day window.</p>
<h2 id="easter-egg">Easter egg</h2>
<p>One more thing, among countless other problems: the recommended way to install Oh My Zsh is either</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh">curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh <span class="kw">|</span> <span class="kw">sh</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span class="kw">wget</span> https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O <span class="kw">-</span> <span class="kw">|</span> <span class="kw">sh</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>Cool, huh? How many of you have the <code>--no-check-certificate</code> option of <code>wget</code> automatically turned on? Thankfully there's no <code>sudo</code> in front.</p>
<h2 id="summary">Summary</h2>
<p>Oh My Zsh was a great idea when it took off. Over the years however, through low-quality community contributions from people who barely understand Zsh (and shell scripting idioms and best practices in general), it evolved into a beast that no one except the maintainers could fix or seriously contribute to; yet the maintainers seem to be pretty satisfied with it.</p>
<p>Therefore, I'm moving to Prezto, the project with far better modularity and code quality. In fact, this rant all began from yesterday, when I was about to embark on a stripped down Zsh configuration system for myself. I was thinking about borrowing code from both Oh My Zsh and Prezto; but after reading some code from both projects, I soon realized that Oh My Zsh is totally crap and Prezto can be taken almost unmodified. I hope that more people will take a look at Prezto, realize how awesome it is (especially in comparison to the famed Oh My Zsh), fork it, and possibly submit patches.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn1"><p>This is not entirely true. I use <a href="https://github.com/felipec/git-remote-bzr">git-remote-bzr</a> when I have to clone a Bazaar repo for some reason.<a href="#fnref1">&#8617;</a></p></li>
<li id="fn2"><p>Note that outside the core, there are additional plugins for <code>git</code> and <code>nvm</code>. Oh well.<a href="#fnref2">&#8617;</a></p></li>
<li id="fn3"><p>Whether aliases defined in a plugin (e.g. for <code>git</code>) should be loaded can be easily controlled via a switch.<a href="#fnref3">&#8617;</a></p></li>
</ol>
</div>

]]>
</content></entry><entry><title type="html">Using Python 3 with Emacs Jedi</title><link href="http://zmwangx.github.io/blog/2015-04-26-using-python-3-with-emacs-jedi.html" /><updated>2015-04-26T21:19:14-07:00</updated><id>http://zmwangx.github.io/blog/2015-04-26-using-python-3-with-emacs-jedi.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Recently I'm working on <a href="https://github.com/zmwangx/storyboard">a hobby project in Python</a>, which means editing Python source files a lot. I've been using <a href="https://github.com/tkf/emacs-jedi">Emacs Jedi</a> for almost as long as I've been writing Python, and it has been pretty helpful at completing away long names.</p>
<p>However, Jedi uses <code>python</code> by default, which means <code>python2</code> on most of our systems at this point. Occasionally I'm writing Python 3 specific code but Jedi completes to Python 2 or refuses to complete; for the record, I enjoy writing and debugging Python 3.3+ much better than 2.7 (I realized this after trying to create a code base that is backward compatible with 2.7, which means reinventing the wheel or introducing annoying branches from time to time). So naturally I'm looking into using Python 3 in Jedi.</p>
<p>The <a href="https://tkf.github.io/emacs-jedi/latest/#how-to-use-python-3-or-any-other-specific-version-of-python">official docs</a> has been confusing and unhelpful at least for me, since it insists on setting up the virtualenv from within Emacs, and it failed for me. Why can't I set up the virtualenv myself? Turns out I can, and it's incredibly simple. The commands below assume that you have installed Jedi and friends (well, dependencies) using <code>package.el</code>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> -p ~/.emacs.d/.python-environments
<span class="kw">virtualenv</span> -p /usr/local/bin/python3 ~/.emacs.d/.python-environments/jedi  <span class="co"># or whatever your python3 path is</span>
<span class="co"># If you feel like installing the server with 'M-x jedi:install-server', also do the following</span>
<span class="kw">~/.emacs.d/.python-environments/jedi/bin/pip</span> install --upgrade ~/.emacs.d/elpa/jedi-20150109.2230/  <span class="co"># you might need to change the version number</span><span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span></code></pre></div>
<p>And that's it. Put the following in your <code>~/.emacs</code>:</p>
<div class="sourceCode"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp">(add-hook 'python-mode-hook 'jedi:setup)
(<span class="kw">setq</span> jedi:complete-on-dot <span class="kw">t</span>)
(<span class="kw">setq</span> jedi:environment-root <span class="st">"jedi"</span>)<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span></code></pre></div>
<p>where the first two lines should be there whether you want to use Python 3 or not &#8212; so only the third line is new, and its meaning is obvious.</p>
<p>At last, start Emacs and do <code>M-x jedi:install-server</code> if you haven't run the <code>pip</code> command above yet. Restart Emacs (if necessary). That's it. Enjoy your Jedi with Python 3. (Type <code>import conf</code>, for instance, to be convinced that you're really autocompleting Python 3).</p>

]]>
</content></entry><entry><title type="html">Back up OS X app icons</title><link href="http://zmwangx.github.io/blog/2015-03-22-back-up-os-x-app-icons.html" /><updated>2015-03-22T16:58:50-07:00</updated><id>http://zmwangx.github.io/blog/2015-03-22-back-up-os-x-app-icons.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>OS X application icons are valuable assets, and it's interesting to see how they evolve over time. This is especially the case when we upgraded to OS X 10.10 Yosemite, when Apple and many design-aware third party developers overhauled (mainly flattened) their icons.</p>
<p>However, we lose all the old icons when we do a major OS upgrade. Technically they still live in Time Machine backups, but those are a pain to pull out. Therefore, I wrote a script just now to back up app icons of all applications living in <code>/Applications</code> (including those symlinked to <code>/Applications</code>, e.g., apps installed through <code>brew cask</code>) and its level-one subdirectories, and <code>/System/Library/CoreServices</code> (for <code>Finder.app</code> and such). Here's the script:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/usr/bin/env bash</span>
<span class="kw">function</span><span class="fu"> app_version</span>
<span class="kw">{</span>
    <span class="co"># $1 is the path to the app</span>
    <span class="kw">/usr/libexec/PlistBuddy</span> -c <span class="st">"print CFBundleShortVersionString"</span> <span class="st">"</span><span class="ot">$1</span><span class="st">"</span>/Contents/Info.plist <span class="kw">2&gt;</span>/dev/null <span class="kw">||</span> <span class="kw">date</span> +%Y%m%d
<span class="kw">}</span>
 
<span class="kw">function</span><span class="fu"> app_icon_path</span>
<span class="kw">{</span>
    <span class="co"># $1 is the path to the app</span>
    <span class="ot">filename=$(</span><span class="kw">/usr/libexec/PlistBuddy</span> -c <span class="st">"print CFBundleIconFile"</span> <span class="st">"</span><span class="ot">$1</span><span class="st">"</span>/Contents/Info.plist <span class="kw">2&gt;</span>/dev/null<span class="ot">)</span>
   <span class="kw"> [[</span> <span class="ot">-n</span> <span class="ot">${filename}</span><span class="kw"> ]]</span> <span class="kw">||</span> <span class="kw">return</span>
    <span class="ot">filename=$(</span><span class="kw">basename</span> <span class="st">"</span><span class="ot">${filename}</span><span class="st">"</span> .icns<span class="ot">)</span>
    <span class="kw">echo</span> <span class="st">"</span><span class="ot">$1</span><span class="st">/Contents/Resources/</span><span class="ot">${filename}</span><span class="st">.icns"</span>
<span class="kw">}</span>
 
<span class="kw">function</span><span class="fu"> process_app</span>
<span class="kw">{</span>
    <span class="co"># $1 is the path to the app</span>
    <span class="ot">name=$(</span><span class="kw">basename</span> <span class="st">"</span><span class="ot">$1</span><span class="st">"</span> .app <span class="kw">|</span> <span class="kw">tr</span> -d <span class="st">' '</span><span class="ot">)</span>
    <span class="ot">path=$(</span><span class="kw">realpath</span> -e <span class="st">"</span><span class="ot">$1</span><span class="st">"</span><span class="ot">)</span> <span class="kw">||</span> <span class="kw">{</span> <span class="kw">echo</span> <span class="st">"</span><span class="ot">${RED}</span><span class="st">error: broken link '</span><span class="ot">${path}</span><span class="st">'</span><span class="ot">${RESET}</span><span class="st">"</span> <span class="kw">&gt;&amp;2;</span> <span class="kw">return</span> 1<span class="kw">;</span> <span class="kw">}</span>
    <span class="ot">version=$(</span><span class="kw">app_version</span> <span class="st">"</span><span class="ot">${path}</span><span class="st">"</span><span class="ot">)</span>
    <span class="ot">icon_path=$(</span><span class="kw">app_icon_path</span> <span class="st">"</span><span class="ot">${path}</span><span class="st">"</span><span class="ot">)</span>
   <span class="kw"> [[</span> <span class="ot">-n</span> <span class="ot">${icon_path}</span><span class="kw"> ]]</span> <span class="kw">||</span> <span class="kw">{</span> <span class="kw">echo</span> <span class="st">"</span><span class="ot">${YELLOW}</span><span class="st">warning: '</span><span class="ot">$1</span><span class="st">' has no app icon</span><span class="ot">${RESET}</span><span class="st">"</span><span class="kw">;</span> <span class="kw">return</span> 1<span class="kw">;</span> <span class="kw">}</span>
   <span class="kw"> [[</span> <span class="ot">-f</span> <span class="ot">${icon_path}</span><span class="kw"> ]]</span> <span class="kw">||</span> <span class="kw">{</span> <span class="kw">echo</span> <span class="st">"</span><span class="ot">${RED}</span><span class="st">error: '</span><span class="ot">${icon_path}</span><span class="st">' does not exist</span><span class="ot">${RESET}</span><span class="st">"</span> <span class="kw">&gt;&amp;2;</span> <span class="kw">return</span> 1<span class="kw">;</span> <span class="kw">}</span>
    <span class="kw">cp</span> <span class="st">"</span><span class="ot">${icon_path}</span><span class="st">"</span> <span class="st">"</span><span class="ot">${name}</span><span class="st">-</span><span class="ot">${version}</span><span class="st">.icns"</span>
    <span class="kw">echo</span> <span class="st">"</span><span class="ot">${name}</span><span class="st">-</span><span class="ot">${version}</span><span class="st">.icns"</span>
<span class="kw">}</span>
 
<span class="kw">find</span> /Applications -maxdepth 2 -name <span class="st">'*.app'</span> <span class="kw">|</span> <span class="kw">while</span> <span class="kw">read</span> <span class="ot">app</span>; <span class="kw">do</span> <span class="kw">process_app</span> <span class="st">"</span><span class="ot">${app}</span><span class="st">"</span><span class="kw">;</span> <span class="kw">done</span>
<span class="kw">find</span> /System/Library/CoreServices -maxdepth 1 -name <span class="st">'*.app'</span> <span class="kw">|</span> <span class="kw">while</span> <span class="kw">read</span> <span class="ot">app</span>; <span class="kw">do</span> <span class="kw">process_app</span> <span class="st">"</span><span class="ot">${app}</span><span class="st">"</span><span class="kw">;</span> <span class="kw">done</span><span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span><span class="line-number" data-line="9" style="top: 144px"><!----></span><span class="line-number" data-line="10" style="top: 162px"><!----></span><span class="line-number" data-line="11" style="top: 180px"><!----></span><span class="line-number" data-line="12" style="top: 198px"><!----></span><span class="line-number" data-line="13" style="top: 216px"><!----></span><span class="line-number" data-line="14" style="top: 234px"><!----></span><span class="line-number" data-line="15" style="top: 252px"><!----></span><span class="line-number" data-line="16" style="top: 270px"><!----></span><span class="line-number" data-line="17" style="top: 288px"><!----></span><span class="line-number" data-line="18" style="top: 306px"><!----></span><span class="line-number" data-line="19" style="top: 324px"><!----></span><span class="line-number" data-line="20" style="top: 342px"><!----></span><span class="line-number" data-line="21" style="top: 360px"><!----></span><span class="line-number" data-line="22" style="top: 378px"><!----></span><span class="line-number" data-line="23" style="top: 396px"><!----></span><span class="line-number" data-line="24" style="top: 414px"><!----></span><span class="line-number" data-line="25" style="top: 432px"><!----></span><span class="line-number" data-line="26" style="top: 450px"><!----></span><span class="line-number" data-line="27" style="top: 468px"><!----></span><span class="line-number" data-line="28" style="top: 486px"><!----></span><span class="line-number" data-line="29" style="top: 504px"><!----></span><span class="line-number" data-line="30" style="top: 522px"><!----></span><span class="line-number" data-line="31" style="top: 540px"><!----></span></code></pre></div>
<p>The script is also available as a <a href="https://gist.github.com/zmwangx/fad97e085045a21ebc1d">gist</a>.</p>

]]>
</content></entry><entry><title type="html">The new OneDrive API</title><link href="http://zmwangx.github.io/blog/2015-02-24-the-new-onedrive-api.html" /><updated>2015-02-24T18:31:19-08:00</updated><id>http://zmwangx.github.io/blog/2015-02-24-the-new-onedrive-api.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Microsoft released the new OneDrive API today. See the blog post announcement <a href="https://blog.onedrive.com/the-new-onedrive-api/">here</a>. One highlight is that <a href="http://onedrive.github.io/items/upload_large_files.htm">large file upload</a> is now officially supported. Previously, large file upload was handled with a semi-official API using the BITS protocol; the only documentation was a <a href="https://gist.github.com/rgregg/37ba8929768a62131e85">gist</a>. Now it is handled through standard HTTP <code>POST</code>. With this major release, there's likely a lot of work to be done with <a href="https://github.com/mk-fg/python-onedrive">python-onedrive</a>. I have opened an issue: <a href="https://github.com/mk-fg/python-onedrive/issues/52">mk-fg/python-onedrive#52 &#8212; New OneDrive API support</a>.</p>
<p>Interestingly, the new OneDrive API doc is hosted on GitHub Pages &#8212; <a href="http://onedrive.github.io">onedrive.github.io</a>, rather than MSDN. Exactly a week ago I wrote a piece, "<a href="/blog/2015-02-17-microsoft-is-getting-cool-but-not-its-website.html">Microsoft is getting cool (but not its website)</a>". Looks like they are doing something about their website (or better put, their online identity), too.</p>

]]>
</content></entry><entry><title type="html">All is not lost</title><link href="http://zmwangx.github.io/blog/2015-02-21-all-is-not-lost.html" /><updated>2015-02-21T17:12:32-08:00</updated><id>http://zmwangx.github.io/blog/2015-02-21-all-is-not-lost.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Lubos Motl always attacks the Many-Worlds Interpretation as if it is on the same level as anti-scientific claims. He even went on to attack Hugh Everett (the guy who first formulated this interpretation) personally; <em>ad hominem</em> is of course typical Motl shit, and I don't bother to find those posts. Anyway, here's yet another one: <a href="http://motls.blogspot.com/2015/02/many-worlds-rozali-carroll-exchange.html">Many worlds: a Rozali-Carroll exchange</a>.</p>
<p>Disclaimer: I'm not really a proponent of Many-Worlds, at least not of the part of it that says history really <em>branches</em> into <em>many</em> worlds. Well, Lubos is at least right about one thing: "many worlds", taken literally, can't even be well-defined. However, I do believe that the world is can be described by a "universal wavefunction" (I prefer to call it the "universal state vector") in some gargantuan Hilbert space. And the universal state vector has to evolve deterministically. The reason is simple: <strong><em>all information is not lost</em></strong>. This principle is fundamental to physics and it's simply not on the same level as falsifiability, which is little more than a philosopher's toy and a nice thing to have. In quantum mechanics' terms, <em>unitarity must be respected</em>; this is why the Copenhagen Interpretation, or at least the wavefunction-collapsing part of it, cannot hold up to serious scrutiny &#8212; no operator can ever collapse the wavefunction and break unitarity. Those who hold the Copenhagen Interpretation are confusing <em>their</em> lack of knowledge (albeit a fundamental one, as they were entangled into the system when they make an observation) with the fundamental loss of information (which is not possible).</p>
<p>One may question that if the universal state vector is <em>real</em>, then where's all the unavailable information stored (why is there a <em>fundamental</em> lack of knowledge)? Well, who told you that all information in this universe can be observed or written down? Everything outside our event horizon is also unavailable to us, yet modern physics knows for sure that some of those <em>do</em> exist. Of course we have a hierarchy of belief in the existence of different things, with the universal state vector being hard to believe (and very hard to not believe) or make sense of. But there's no hard cut, and we might some day be able to reason about it.</p>
<p>I don't know how exactly the observed universe is the way it is (i.e., how exactly it fell &#8212; or "collapsed", which is a convenient word for communication &#8212; into the eigenstate that we observed). I'm not even sure if the observed universe is the way it is in the objective (ontological) sense &#8212; if there were no observers, would it just be an "uncollapsed" state vector? I suspect that this problem has something to do with consciousness, and I suspect that we are at least hundreds of years from understanding consciousness. (Of course this kind of predictions are all nonsense &#8212; no one can look thirty years into the future). At the very least, we may eliminate some possibilities when we know more about consciousness. At any rate, this is an interesting problem that might be outside the capability of human reason, or might not. One may hate it and refuse to talk about it, but one cannot dismiss it as unphysical.</p>
<p>When Lubos dismisses <em>ontology</em> as "exactly the same thing" as classical physics, he's dismissing the problem above, and making a hard compromise. He's basically saying that we cannot and should not reason about anything outside of what we can observe (this is also a crude classification because obviously he reasons beyond black hole horizons every day). This compromise is very dangerous for physics &#8212; sometimes one has to reason beyond one's horizon to formulate a complete and consistent answer. Black holes are one good example of getting of the limit. If we can extend spacetime beyond our event horizon, then why can't we accept <strong><em>the possibility of existence</em></strong> outside our "existence horizon", i.e., outside our perceived existence of the universal (and the first hand experience of our own existence inside it)? It's a wild and not well-defined idea, but all new physics starts out not well-defined.</p>
<p>I still remember the last lecture of my first quantum mechanics course in my freshman year, taught by Prof. Michael Peskin. He discussed the interpretations of quantum mechanics. I forgot the exact arguments, but after rejecting other interpretations (including Copenhagen and hidden variable), he resorted to Many-Worlds, citing "Once you eliminate the impossible, whatever remains, no matter how improbable, must be the truth." I was not particularly satisfied. To me, once you eliminate the impossible, if whatever remains is still improbable, then maybe your imagination is not wild enough. I also remember the second time I took QM I, this time the graduate version, taught by Prof. Lenny Susskind. He stressed unitarity so much and showed us how wavefunction-collapsing is unnecessary (it was never well-defined anyway, unless you impose it). Unitarity is so important that triggered his "black hole war".</p>
<p>The point of mentioning my two professors is that the interpretation problem of quantum mechanics has never been settled, and people who hold opinions contrary to Copenhagen should be respected. Lubos, on the other hand, tries to convince people that this problem has been settled, and actually settled for ninety years. He is either lying or delusional himself.</p>

]]>
</content></entry><entry><title type="html">My dock and updated OmniFocus</title><link href="http://zmwangx.github.io/blog/2015-02-20-my-dock-and-updated-omnifocus.html" /><updated>2015-02-20T16:16:10-08:00</updated><id>http://zmwangx.github.io/blog/2015-02-20-my-dock-and-updated-omnifocus.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<blockquote>
<p>Simplicity is the ultimate sophistication.</p>
</blockquote>
<p>Here's a screenshot of my dock at the moment.</p>
<div class="figure">
<img alt="My dock" src="https://i.imgur.com/EhaJw57.png" title="My current dock. Left to right: Finder (TotalFinder), Mail, Safari, Chrome, iTunes, OmniFocus, iTerm2, Activity Monitor, and mpv. Everything except mpv is persistent."/>
<p class="caption">My dock</p>
</div>
<p>Left to right: Finder (TotalFinder), Mail, Safari, Chrome, iTunes, OmniFocus, iTerm2, Activity Monitor, and mpv. Everything except mpv is persistent; mpv is there because I happen to be looping a piece of music with mpv that I don't plan to add to the iTunes library. The point is that it never looked this good, mainly due to the updated OmniFocus icon. Finally they put some serious thought into graphics design! Just compare <a href="https://dl.bintray.com/zmwangx/generic/omnifocus-v2.1.icns">the v2.1 icon</a> to <a href="https://dl.bintray.com/zmwangx/generic/omnifocus-v2.0.icns">the v2.0 version</a>.</p>
<div class="figure">
<img alt="OmniFocus Mac app icon, v2.0 vs v2.1" src="https://i.imgur.com/KeTz5wK.png"/>
<p class="caption">OmniFocus Mac app icon, v2.0 vs v2.1</p>
</div>
<p>Obviously the overpolished (and honestly, badly polished) 2.0 one belongs to the past. It "stood out" even among Mavericks dock icons (in terms of color), not to mention among the flattened-down Yosemite ones. Today, it finally becomes a native member of the dock. (Well, actually not today &#8212; I've been using the beta for a while, so the new icon didn't come as a surprise.) In fact, this time the Omni Group seems to be on a graphics design streak these days, and today they have a really impressive App Store feature banner:</p>
<div class="figure">
<img alt="OmniFocus's MAS feature banner" src="https://i.imgur.com/tILmveQ.png"/>
<p class="caption">OmniFocus's MAS feature banner</p>
</div>

]]>
</content></entry><entry><title type="html">Microsoft is getting cool (but not its website)</title><link href="http://zmwangx.github.io/blog/2015-02-17-microsoft-is-getting-cool-but-not-its-website.html" /><updated>2015-02-17T18:57:19-08:00</updated><id>http://zmwangx.github.io/blog/2015-02-17-microsoft-is-getting-cool-but-not-its-website.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Microsoft is getting kind of cool. For instance, open sourcing .NET last year caused quite a buzz. Ars has a good piece about this: <a href="http://arstechnica.com/information-technology/2015/02/microsofts-continuing-efforts-to-be-cool/">Microsoft&#8217;s continuing efforts to be cool</a>.</p>
<p>Three weeks ago Microsoft made another minor but totally unexpected move: they integrated AgileBits' <code>onepassword-app-extension</code> (<a href="https://github.com/AgileBits/onepassword-app-extension">GitHub</a>) into the 5.0 release of the OneDrive iOS app. I didn't realize this until I read <a href="https://blog.onedrive.com/onedrive_secure_password/">yesterday's blog post on the OneDrive Blog</a>. This is really amazing when you put it in context: I mean, take a look at <a href="https://blog.agilebits.com/1password-apps/">Apps that love 1Password</a>, i.e., apps that have integrated that extension. Out of the ninety apps listed to date, there are only a dozen apps that I've heard of, and the only brands bigger than 1Password are Microsoft, Tumblr, Uber (infamous), and Walmart (what?). Microsoft embracing third party is surely an interesting phenomenon.</p>
<p>Meanwhile,</p>
<ul>
<li>Microsoft still won't let us use our password managers to its fullest (of course we can't blame it on the OneDrive folks): 16 characters max in this day and age (screenshot taken today)? Hmm. And I remember Microsoft recently said password length isn't the main source of vulnerability of its customers. WTF. Who cares about <em>your</em> stupid customers. I just want to protect <em>my own</em> data, and make sure that in case of a breach on <em>your</em> side, I won't face the same loss as your technologically illiterate customers. But that's not currently possible with Microsoft.</li>
</ul>
<div class="figure">
<img alt="It's 2015, yet &quot;your password can't be longer than 16 characters&quot;." src="https://i.imgur.com/CNv76zw.png"/>
<p class="caption">It's 2015, yet "your password can't be longer than 16 characters".</p>
</div>
<ul>
<li>Microsoft's UI design is still shit, <a href="/blog/2015-01-21-web-design-microsoft-vs-apple.html">as well as their website</a>; I mean, seriously:</li>
</ul>
<div class="figure">
<img alt="What the heck are those blue blocks?" src="https://i.imgur.com/wu66zZc.png"/>
<p class="caption">What the heck are those blue blocks?</p>
</div>

]]>
</content></entry><entry><title type="html">Monitor progress of your Unix pipes with pv</title><link href="http://zmwangx.github.io/blog/2015-02-10-monitor-progress-of-your-unix-pipes-with-pv.html" /><updated>2015-02-10T02:18:30-08:00</updated><id>http://zmwangx.github.io/blog/2015-02-10-monitor-progress-of-your-unix-pipes-with-pv.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>Recently I found a very useful utility called <code>pv</code> (for "pipe viewer"). <a href="http://www.ivarch.com/programs/pv.shtml">Here</a> is its home page, and it can be easily installed with <code>brew</code>. According to its man page,</p>
<blockquote>
<p><code>pv</code> shows the progress of data through a pipeline by giving information such as time elapsed, percentage completed (with progress bar), current throughput rate, total data transferred, and ETA.</p>
</blockquote>
<p>For more info, see its home page (linked above) and <a href="http://linux.die.net/man/1/pv">man page</a>.</p>
<p>Why is it useful? Well, pretty obvious if you are in the right audience. For me, one particularly important use case is with <code>openssl sha1</code>. I deal with videos on a daily basis, and back up all of them to OneDrive (ever since OneDrive went unlimited). To ensure integrity of transfer (in future downloads), I append the first seven digits of each video to its filename. This should be more than enough to reveal any error in transfer except for active attacks. One additional advantage is that I can now have multiple versions of a same show, event, or whatever and don't have to worry about naming conflicts (and don't have to artificially say <code>-ver1</code>, <code>-ver2</code>, etc.). This little merit turns out to be huge and saves me a lot of trouble, since naming things is intrinsically hard:</p>
<blockquote>
<p>There are only three hard things concurrency, in computer science: cache invalidation, naming things, and off-by-one errors.</p>
</blockquote>
<p>(I learned this beefed up version of two hard things only recently.) Well, too much digression. So SHA-1 sum is useful. (By the way, I learned in my crypto class that SHA-1 is broken as a collision-resistant hash function &#8212; not HMAC, which doesn't assume collision-resistance &#8212; and SHA-256 should be used instead. However, I'm not protecting against active attacks &#8212; I won't be able to without a shared secret key anyway &#8212; so the faster SHA-1 is good for my purpose.) But at the same time, SHA-1 is slow. Maybe what's actually slow is my HDD. Whatever the bottleneck, generating a SHA-1 digest for a 10 GB video file isn't fun at all; it's even more of a torture when there's no progress bar and ETA. But hopelessly waiting has become a thing of the past with the advent (well, discovery in my case) of <code>pv</code>. Now I have nice and informative progress bars, which reduces the anxiety of waiting by an order of magnitude.</p>
<p>For the record, here's the current version of my ruby script that attaches the first seven digits of the SHA-1 digests of the given files to their filenames:</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="kw">#!/usr/bin/env ruby</span>

require <span class="st">'fileutils'</span>

<span class="kw">def</span> rename(items)
  num_items = items.length
  num_done = <span class="dv">0</span>
  items.each {|path|
    printf(<span class="dt">$stderr</span>, <span class="st">"%d/%d: %s\n"</span>, num_done + <span class="dv">1</span>, num_items, <span class="dt">File</span>.basename(path))

    <span class="kw">if</span> ! <span class="dt">File</span>.directory?(path)
      extname = <span class="dt">File</span>.extname(path)
      basename = <span class="dt">File</span>.basename(path, extname)
      dirname = <span class="dt">File</span>.dirname(path)
      sha1sum = <span class="st">`pv '</span><span class="ot">#{</span>path<span class="ot">}</span><span class="st">' | openssl sha1`</span>
      new_basename = basename + <span class="st">"__"</span> + sha1sum[<span class="dv">0</span>,<span class="dv">7</span>]
      new_path = <span class="dt">File</span>.join(dirname, new_basename + extname)
      <span class="dt">FileUtils</span>.mv(path, new_path)
    <span class="kw">else</span>
      <span class="dt">STDERR</span>.puts(<span class="st">"</span><span class="ot">#{</span>path<span class="ot">}</span><span class="st">: directory ignored"</span>)
    <span class="kw">end</span>
    
    num_done += <span class="dv">1</span>
  }
<span class="kw">end</span>

rename(<span class="dt">ARGV</span>)<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span><span class="line-number" data-line="9" style="top: 144px"><!----></span><span class="line-number" data-line="10" style="top: 162px"><!----></span><span class="line-number" data-line="11" style="top: 180px"><!----></span><span class="line-number" data-line="12" style="top: 198px"><!----></span><span class="line-number" data-line="13" style="top: 216px"><!----></span><span class="line-number" data-line="14" style="top: 234px"><!----></span><span class="line-number" data-line="15" style="top: 252px"><!----></span><span class="line-number" data-line="16" style="top: 270px"><!----></span><span class="line-number" data-line="17" style="top: 288px"><!----></span><span class="line-number" data-line="18" style="top: 306px"><!----></span><span class="line-number" data-line="19" style="top: 324px"><!----></span><span class="line-number" data-line="20" style="top: 342px"><!----></span><span class="line-number" data-line="21" style="top: 360px"><!----></span><span class="line-number" data-line="22" style="top: 378px"><!----></span><span class="line-number" data-line="23" style="top: 396px"><!----></span><span class="line-number" data-line="24" style="top: 414px"><!----></span><span class="line-number" data-line="25" style="top: 432px"><!----></span><span class="line-number" data-line="26" style="top: 450px"><!----></span><span class="line-number" data-line="27" style="top: 468px"><!----></span></code></pre></div>
<p>You might ask why I used ruby (littered with bash) when it's obviously a job for bash or perl. Well, the reason is that I first wrote this thing in ruby as a <a href="https://gist.github.com/zmwangx/d6406fb8bf51ac768770">Dropzone 3 action</a>. I'm lazy, so I just borrowed that script and modified its printout for shell use.</p>
<hr/>
<p>By the way, I also found a project called <code>cv</code> (Coreutils Viewer), which is <a href="https://github.com/Xfennec/cv">officially described as</a></p>
<blockquote>
<p>... a Tiny, Dirty, Linux-Only C command that looks for coreutils basic commands (cp, mv, dd, tar, gzip/gunzip, cat, etc.) currently running on your system and displays the percentage of copied data.</p>
</blockquote>
<p>I'll look into it when I have time, but it from its description, it seems to be limited to coreutils, and OS X support might not be too awesome (at this point).</p>

]]>
</content></entry><entry><title type="html">Web design: Microsoft vs Apple</title><link href="http://zmwangx.github.io/blog/2015-01-21-web-design-microsoft-vs-apple.html" /><updated>2015-01-21T16:30:51-08:00</updated><id>http://zmwangx.github.io/blog/2015-01-21-web-design-microsoft-vs-apple.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I just had a look at Ars's live blog on today's Windows 10 Event to acquire a sense of where Windows is heading. There's not much to report. Safari rip-off (Microsoft's new Spartan &#8212; wait, is this name also inspired by Safari? &#8212; features reading mode and offline reading list, Safari's killer features) aside, the focus seems to be virtual assistant, PC-tablet-phone integration, and gaming, none of which I'm interested in. The hologram thing does look cool, but putting the hype aside, I doubt if it will be really useful for the masses (except probably in gaming, one of my most despised applications of computing). I'm not a visionary so maybe I'm underestimating this.</p>
<p>(Another interesting development is "Windows as a Service" &#8212; WaaS? Microsoft isn't communiating it effectively. If it means paid subscription, am I ever going to subscribe to an OS? No. If it instead means free system updates for the lifetime of a device, then this WaaS thing is just a vacuous buzz phrase &#8212; Apple has already been doing it for two years. Longer if you count the cheap upgrades. However, if free system updates is indeed the case, then what about VMs? Not sure.)</p>
<p>The only thing I would like to see Apple copy from Microsoft is the unlimited OneDrive &#8212; come on, we already paid enough for our hardware, why can't we have unlimited cloud storage? I would even pay $10 per month for that &#8212; Microsoft is offering Office 365 along with unlimited cloud storage, all for just $10, so it certainly won't hurt Apple. The current iCloud pricing is ridiculous.</p>
<p>All the discussions above are not the main point of this post though. The point is, I went to the Windows website to learn more about Windows 10, and just can't believe my eyes in how awful it is designed. Just look at the font and the layout of <a href="http://windows.microsoft.com/en-us/windows-10/about">windows.microsoft.com/en-us/windows-10/about</a> (full web page screenshot courtesy of <a href="http://web-capture.net">web-capture.net</a>). And compare that to <a href="http://www.apple.com/osx/">www.apple.com/osx/</a> (scroll past the Windows screenshot). Holy crap, I even booted my Windows 8.1 VM just to make sure I'm not lacking the necessary fonts available on Windows.</p>
<p>Why Microsoft's web design is so shitty is always beyond my grasp. For OS X, a potential customer would be eager to set his hands on it just by looking at its beautifully-crafted homepage and a few screenshots there. For Windows it's exactly the opposite. I mean, apart from metro apps (worst and ugliest desktop experience ever), modern Windows actually looks pretty good. But their shitty advertising totally ruins it. I guess it doesn't matter much for Microsoft, for all design-savvy folks who are not stuck on Windows are already using OS X, and most of their customers just need a commodity OS.</p>
<div class="figure">
<img alt="Full height screenshot of windows.microsoft.com/en-us/windows-10/about." src="https://i.imgur.com/0eIt4SR.png"/>
<p class="caption">Full height screenshot of <a href="http://windows.microsoft.com/en-us/windows-10/about">windows.microsoft.com/en-us/windows-10/about</a>.</p>
</div>
<div class="figure">
<img alt="Full height screenshot of www.apple.com/osx/." src="https://i.imgur.com/piUO0xY.png"/>
<p class="caption">Full height screenshot of <a href="http://www.apple.com/osx/">www.apple.com/osx/</a>.</p>
</div>

]]>
</content></entry><entry><title type="html">Fonts: why Chinese web design is hard</title><link href="http://zmwangx.github.io/blog/2015-01-10-fonts-why-chinese-web-design-is-hard.html" /><updated>2015-01-10T09:30:02-08:00</updated><id>http://zmwangx.github.io/blog/2015-01-10-fonts-why-chinese-web-design-is-hard.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>For years I've been complaining about Chinese websites' horrendous designs. Yesterday I tried to translate one of my simple project websites to Chinese, and finally realized that web design for the Chinese language is no simple task &#8212; much harder than for English. The problem is fonts. This might not be the only problem (and cannot take blame for all the horrendous designs), but it certainly seems to be a roadblock.</p>
<p>The problem with fonts boils down to the fact that the Chinese writing system has too many glyphs. I still remember learning things about the GB 2312 charset when I was twelve &#8212; there are 3755 Level 1 characters (more commonly seen), 3008 Level 2 characters, and other symbols and foreign glyphs. Designing more than six thousand Chinese characters is so much harder than designing 26 letters. I'm not sure if many glyphs are auto-generated from parts, but that would certainly degrade the quality. The result? Availability of digital fonts suffers. There are simply not so many choices of Chinese fonts. Chinese writing is beautiful, but I've yet to see a font for screens (let alone the web) that conveys that beauty. This might be subjective, but I have the impression that fonts generally look worse on screen than in print, and more so for Chinese fonts (Retina doesn't help much). For the record, I checked Apple's font usage at the moment, and they are using a tailored font named "PingHei" ("&#24179;&#40657;", I guess; see screenshot at the end); I'm not at all impressed. Compare that to the English counterpart (also at the end) &#8212; not on the same level. (I won't talk about Microsoft since it doesn't feature a design department, or that department is brain dead. Well, I'm a little opinionated.)</p>
<p>Another problem triggered by the vast number of glyphs is that font files are large. I looked at a dozen OTF fonts with SC or TC glyphs, and none seems to be below 10 MB. That's clearly a no go on the web &#8212; not until everyone has a gigabit connection, I suppose. I tried to Google for Chinese webfonts and had little success, so I'm not sure if woff helps. I've heard that Apple is able to pack a reduced set of PingHei glyphs into woffs less than 1 MB (keep in mind that PingHei being sans serif is simpler than serif fonts like Songti); that's pretty remarkable. I don't know much about font technologies so I can't comment more on this matter, but from my observation all Chinese websites (with the exception of apple.com/cn, I guess) rely on locally installed fonts, and most don't even have a list of fallbacks, i.e., typefaces simply aren't part of their designs. Even if they do have a list of fallbacks, they won't be able to guarantee uniform experience across the board (as far as I know, the lowest common denominator of Chinese fonts across all platforms seem to be zero). Apple has taught us that design must be integrated and perfected (well, Apple wasn't the first to do design, but they did bring it to the digital world and to the masses). Any fragmented design is doomed to fail.</p>
<div class="figure">
<img alt="A section of apple.com/cn/iphone-6." src="https://i.imgur.com/MPmtSJI.png"/>
<p class="caption">A section of <a href="https://www.apple.com/cn/iphone-6/">apple.com/cn/iphone-6</a>.</p>
</div>
<div class="figure">
<img alt="The English equivalent." src="https://i.imgur.com/hBpdv0B.png"/>
<p class="caption">The English equivalent.</p>
</div>

]]>
</content></entry><entry><title type="html">OS X system ruby encoding annoyance</title><link href="http://zmwangx.github.io/blog/2015-01-01-os-x-system-ruby-encoding-annoyance.html" /><updated>2015-01-01T22:49:39-08:00</updated><id>http://zmwangx.github.io/blog/2015-01-01-os-x-system-ruby-encoding-annoyance.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I've been using RVM (with fairly up-to-date Rubies) and pry since my day one with Ruby (well, almost), so it actually surprises me today when I found out by chance how poorly the system Ruby behaves when it comes to encoding.</p>
<p>The major annoyance with the current system Ruby (2.0.0p481) is that it can't convert <code>UTF8-MAC</code> to <code>UTF-8</code> (namely, NFD to NFC, as far as I can tell), at least not with Korean characters. Consider the following script:</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># coding: utf-8</span>
require <span class="st">'hex_string'</span>
str = <span class="st">"&#4363;&#4454;&#4363;&#4469;&#4369;&#4469;&#4540;&#4367;&#4467;"</span>
puts str.to_hex_string
puts str.encode(<span class="st">"UTF-8"</span>, <span class="st">"UTF8-MAC"</span>).to_hex_string<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span></code></pre></div>
<p>Here are what I get with the system Ruby and the latested brewed Ruby:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span> <span class="kw">/usr/bin/ruby</span> --version
<span class="kw">ruby</span> 2.0.0p481 (2014-05-08 revision 45883) [<span class="kw">universal.x86_64-darwin14</span>]
<span class="kw">&gt;</span> <span class="kw">/usr/local/bin/ruby</span> --version
<span class="kw">ruby</span> 2.2.0p0 (2014-12-25 revision 49005) [<span class="kw">x86_64-darwin14</span>]
<span class="kw">&gt;</span> <span class="kw">/usr/bin/ruby</span> utf8-mac.rb
<span class="kw">e1</span> 84 8b e1 85 a6 e1 84 8b e1 85 b5 e1 84 91 e1 85 b5 e1 86 bc e1 84 8f e1 85 b3
<span class="kw">e1</span> 84 8b e1 85 a6 e1 84 8b e1 85 b5 e1 84 91 e1 85 b5 e1 86 bc e1 84 8f e1 85 b3
<span class="kw">&gt;</span> <span class="kw">/usr/local/bin/ruby</span> utf8-mac.rb
<span class="kw">e1</span> 84 8b e1 85 a6 e1 84 8b e1 85 b5 e1 84 91 e1 85 b5 e1 86 bc e1 84 8f e1 85 b3
<span class="kw">ec</span> 97 90 ec 9d b4 ed 95 91 ed 81 ac<span class="line-number" data-line="1" style="top: 0px"><!----></span><span class="line-number" data-line="2" style="top: 18px"><!----></span><span class="line-number" data-line="3" style="top: 36px"><!----></span><span class="line-number" data-line="4" style="top: 54px"><!----></span><span class="line-number" data-line="5" style="top: 72px"><!----></span><span class="line-number" data-line="6" style="top: 90px"><!----></span><span class="line-number" data-line="7" style="top: 108px"><!----></span><span class="line-number" data-line="8" style="top: 126px"><!----></span><span class="line-number" data-line="9" style="top: 144px"><!----></span><span class="line-number" data-line="10" style="top: 162px"><!----></span></code></pre></div>
<p>As you can see, in the case of the system Ruby, NFD is left untouched. This leads to problems with, for instance, Google Translate. One obvious solution is to outsource the task to <code>iconv</code>, but I have the impression that outsourcing language features to shell commands is a generally despised practice.</p>
<p>There's one more surprise. While <code>pry</code> with latest Rubies tend to handle Unicode very well (unlike <code>irb</code>), I tried <code>pry</code> with the current system Ruby, and it doesn't work; due to this annoying limitation, I couldn't even test the above problem interactively, and had to resort to a script. Maybe the problem can be resolved by compiling Ruby with <code>readline</code> or whatever; I didn't bother. The bottom line is, the system Ruby is not very pleasant for men in the 21st century &#8212; good Unicode support ought to be a must. (By the way, NFD in HFS+ is maddening. It breaks Terminal, iTerm, Google Translate, scp with Linux hosts, and the list goes on.)</p>
<p>P.S. In Dropzone 3 custom actions you can select a custom Ruby with the <code>RubyPath</code> meta field, e.g.,</p>
<div class="sourceCode"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># RubyPath: /usr/local/bin/ruby</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>

]]>
</content></entry><entry><title type="html">mpv launcher</title><link href="http://zmwangx.github.io/blog/2014-12-23-mpv-launcher.html" /><updated>2014-12-23T00:51:05-08:00</updated><id>http://zmwangx.github.io/blog/2014-12-23-mpv-launcher.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p><strong><em>04/06/2015 update:</em></strong></p>
<p>I just noticed that <code>daemonize</code> doesn't play too well with the OS; in particular, when you use dark menu bar on OS X Yosemite, apps launched with <code>daemonize</code> won't conform to that. So a native shell solution would be using <code>/bin/zsh</code> and run</p>
<div class="sourceCode"><pre class="sourceCode zsh"><code class="sourceCode zsh">mpv <span class="st">"</span><span class="ot">$@</span><span class="st">"</span> <span class="kw">&gt;</span>/dev/null <span class="kw">2&gt;&amp;1</span> <span class="kw">&lt;</span>/dev/null <span class="kw">&amp;</span>!<span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>instead.</p>
<hr/>
<p><a href="http://mpv.io"><code>mpv</code></a> is a nice simplistic video player (fork of MPlayer and mplayer2). The CLI is flawless (and you can run as many instances as you want), but when it comes to the OS X application bundle, there's one major annoyance. Each app bundle could only have one running instance (unless <code>open -n</code>&#8217;ed, which is not how sane people use app bundles), and one instance of <code>mpv</code> only supports one video. So, say I'm playing one video with the app bundle, and unsuspectingly opens another in Finder (which is associated to <code>mpv.app</code> by default), then the latter video immediately takes over, and the position in the first video is lost. That happens <em>a lot</em>.</p>
<p>Today I finally gave this issue some serious thought (I've been on a bug report/enhancement request spree these days so it's natural for me to start thinking about enhancements). Turns out that there's a pretty simple workaround. I created an automator app <code>mpv-launcher.app</code> that does one thing: "Run Shell Script" (pass input as arguments)</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">daemonize</span> /usr/local/bin/mpv <span class="st">"</span><span class="ot">$@</span><span class="st">"</span><span class="line-number" data-line="1" style="top: 0px"><!----></span></code></pre></div>
<p>in the shell of your choice (for me the shell of choice is <code>zsh</code> since the env would be readily available from my <code>zshenv</code>). <code>daemonize</code>, as the name suggests, daemonizes the process so that the process doesn't block; this way, <code>mpv-launcher.app</code> immediately quits after launching, making multiple "instances" possible. (<code>daemonize</code> can be installed via <code>brew install daemonize</code>; note that you need to specify the full path of the command to daemonize, which in my case is <code>/usr/local/bin/mpv</code>). And there you go. Associate your video files to <code>mpv-launcher.app</code>. Launch as many instances as you want. Enjoy.</p>
<p>By the way, I also filed an <a href="https://github.com/mpv-player/mpv/issues/1377">enhancement request</a> with <code>mpv-player/mpv</code>. We'll see what the developers can do. Hopefully the app bundle will support multiple videos out of box in the future.</p>

]]>
</content></entry><entry><title type="html">10k images on imgur</title><link href="http://zmwangx.github.io/blog/2014-12-22-10k-images-on-imgur.html" /><updated>2014-12-22T12:42:16-08:00</updated><id>http://zmwangx.github.io/blog/2014-12-22-10k-images-on-imgur.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I happened to check my imgur account just now (haven't been to the web interface for ages), and you know what, I have uploaded 10,744 images since I created the account in February this year! (I've been using imgur for longer than that; previously I uploaded images anonymously.) Most of the 10k images were uploaded via scripts using the API. This again demonstrates the importance of a good API &#8212; without the imgur API I wouldn't have been able to upload hundreds of images with a few keystrokes all in a snap, and getting links would be a huge pain in the ass. There are myriad image hosting services out there, but imgur rules 'em all, thanks to its decent API (and also its good CDN and direct image links, of course).</p>

]]>
</content></entry><entry><title type="html">App suggestion: Dropzone 3</title><link href="http://zmwangx.github.io/blog/2014-12-19-app-suggestion-dropzone-3.html" /><updated>2014-12-19T14:08:57-08:00</updated><id>http://zmwangx.github.io/blog/2014-12-19-app-suggestion-dropzone-3.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I recently tried and purchased <a href="https://aptonic.com/dropzone3/">Dropzone 3</a>. See a list of features on the linked official website. In short, Dropzone 3 provides an intermediate zone for drag-n-drop. You can use it as a stash (called "Drop Bar" &#8212; stacking is available), use it as a shortcut by putting frequently used folders and applications there, or trigger actions by dropping. There are a dozen builtin actions and <a href="https://aptonic.com/dropzone3/actions/">an additional list of readily available actions</a>, covering common web drives, SNS and file sharing sites. <strong>Better yet, you can develop your custom actions with the easy-to-use <a href="https://github.com/aptonic/dropzone3-actions/blob/master/README.md#dzalerttitle-message">Ruby API</a>.</strong> For instance, I wrote a simple Google Translate action, <code>Google Translate.dzbundle</code> (<a href="https://gist.github.com/zmwangx/b27f106a8ba47468a43d">link</a>), based on <a href="https://github.com/soimort/translate-shell">translate-shell</a>. (You know, it's Ruby, so calling external commands and concatenating strings feel at home, as if you are coding in Perl or directly in shell; unlike Python, where you at least need to <code>import subprocess</code> then <code>subprocess.check_output</code> to get the output of an external command, and have to use a bunch of stupid <code>+</code>'s to get your goddamn message to print.)</p>
<p>Although I use the terminal for most tasks, drag-n-drop is still useful and convenient at times, not to mention the custom actions. (And the stock drag-n-drop is kinda hit-and-miss, especially for people like me who are mostly working with windows maximized &#8212; except terminal windows.) After using Dropzone 3 for a while, I found it well worth $4.99.</p>
<p>Wait, I didn't mention the pricing? Dropzone 3 is only <a href="https://itunes.apple.com/us/app/dropzone-3/id695406827?ls=1&amp;mt=12">$4.99 on MAS</a>, so get it while supplies last. (Somehow the license is $10 on the developer's online store, so definitely buy from MAS and change to the <a href="https://aptonic.com/dropzone3/sandboxing.php">unsandboxed version</a> later &#8212; de-sandboxing is free.) There's also a 15-day free trial.</p>

]]>
</content></entry><entry><title type="html">The Google Chrome Comic &#8212; A classic</title><link href="http://zmwangx.github.io/blog/2014-12-14-the-google-chrome-comic-a-classic.html" /><updated>2014-12-14T17:42:55-08:00</updated><id>http://zmwangx.github.io/blog/2014-12-14-the-google-chrome-comic-a-classic.html</id><author><name>Zhiming Wang</name><uri>http://zmwangx.github.io</uri><email>zmwangx@gmail.com</email></author><content type="html">
<![CDATA[

<p>I was cleaning up my Opera bookmarks just now &#8212; I'm semi-officially leaving Opera for Safari. Of course, Safari still can't handle everything (e.g., Adblock Plus is still not so good on Safari, YouTubeCenter lags behind and I don't bother to compile myself &#8212; yes, I have a certificate, and some power user features simply don't exist), so I'm still going to Opera/Opera beta/Chrome/Firefox for certain tasks. But Safari is very nice. For the first time.</p>
<p>I started out as a Chrome user (well, don't want to recall the IE days), branched out to the Chromium Opera, and now ended up in Safari. Not sure about the future. When I look back, something nostalgic pops up in mind &#8212; <a href="http://www.google.com/googlebooks/chrome/">the Google Chrome Comic</a>. I enjoyed it more than once, but I never seemed to have archived it. So here it is, combined into <a href="https://dl.bintray.com/zmwangx/generic/2008-chrome-comic.pdf">one PDF</a>. In fact, you can create the PDF yourself:</p>
<pre><code>seq 0 39 | parallel wget -q http://www.google.com/googlebooks/chrome/images/big/{}.jpg
convert $(ls -v *.jpg) 2008-chrome-comic.pdf</code></pre>
<p>Here I was a bit lazy and used a GNU <code>ls</code> feature: <code>-v</code> for natural sorting of numbers (doesn't work for BSD <code>ls</code>).</p>
<p>And here's page 1 of the comic as a teaser:</p>
<div class="figure">
<img alt="Google Chrome &#8212; Behind the Open Source Browser Project" src="https://i.imgur.com/W5pJTjl.jpg"/>
<p class="caption">Google Chrome &#8212; Behind the Open Source Browser Project</p>
</div>

]]>
</content></entry></feed>
